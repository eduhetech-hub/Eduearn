<!DOCTYPE html>
<html lang="en">
<head>
    <!-- ===================================================== -->
    <!-- OPTIMIZED SEO & METADATA SECTION -->
    <!-- ===================================================== -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EduHeTech - Learn & Earn | Study Smart, Earn More</title>
    <meta name="description" content="EduHeTech is a revolutionary Learn & Earn platform where you can study valuable skills and earn money through quizzes, courses, and daily activities. Perfect for students and professionals in Nigeria and across Africa.">
    <meta name="keywords" content="learn and earn, EduHeTech, online learning Nigeria, earn money online, quizzes for cash, educational app, e-learning Africa">
    <meta name="author" content="EduHeTech">
    <meta name="robots" content="index, follow">
    
    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="EduHeTech - Learn & Earn | Study Smart, Earn More">
    <meta property="og:description" content="Study valuable skills and earn money through quizzes, courses, and daily activities on EduHeTech.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://eduhetech.com">
    <meta property="og:image" content="https://eduhetech.com/images/og-image.jpg">
    <meta property="og:site_name" content="EduHeTech">
    
    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="EduHeTech - Learn & Earn | Study Smart, Earn More">
    <meta name="twitter:description" content="Study valuable skills and earn money through quizzes, courses, and daily activities.">
    <meta name="twitter:image" content="https://eduhetech.com/images/twitter-image.jpg">
    <meta name="twitter:site" content="@EduHeTech">
    
    <!-- Canonical URL -->
    <link rel="canonical" href="https://eduhetech.com">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    
    <!-- Preconnect for performance -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    
    <!-- CSS and Fonts -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    
    <!-- JSON-LD Schema for EducationalOrganization -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "EducationalOrganization",
      "name": "EduHeTech",
      "description": "Learn & Earn platform where users study valuable skills and earn money through educational activities",
      "url": "https://eduhetech.com",
      "logo": "https://eduhetech.com/images/logo.png",
      "sameAs": [
        "https://facebook.com/EduHeTech",
        "https://twitter.com/EduHeTech",
        "https://instagram.com/EduHeTech"
      ],
      "address": {
        "@type": "PostalAddress",
        "addressCountry": "NG"
      },
      "offers": {
        "@type": "Offer",
        "description": "Educational courses with monetary rewards"
      }
    }
    </script>
    
    <style>
        :root {
            --primary-color: #3b82f6;
            --secondary-color: #1d4ed8;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
            min-height: 100vh;
            margin: 0;
            padding: 0;
            overflow-x: hidden;
        }
        
        .btn-primary {
            background-color: var(--primary-color);
            border-radius: 0.5rem;
            color: white;
            transition: transform 0.1s ease;
        }
        
        .btn-primary:hover {
            background-color: var(--secondary-color);
            transform: translateY(-1px);
        }
        
        .card {
            background-color: white;
            border-radius: 1rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.06);
        }
        
        .modal-overlay {
            background-color: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(3px);
            z-index: 50;
        }
        
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .streak-flame {
            animation: pulse 1.5s infinite alternate;
        }
        
        @keyframes pulse {
            from { transform: scale(1); }
            to { transform: scale(1.1); }
        }
        
        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background-color: var(--danger-color);
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-size: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .achievement-badge {
            transition: transform 0.3s ease;
        }
        
        .achievement-badge:hover {
            transform: scale(1.1);
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .slide-in {
            animation: slideIn 0.3s ease-out;
        }
        
        @keyframes slideIn {
            from { transform: translateY(10px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .course-content {
            max-height: 60vh;
            overflow-y: auto;
            padding: 1rem;
            background-color: #f9fafb;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
        }
        
        .course-section {
            margin-bottom: 1.5rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .course-section:last-child {
            border-bottom: none;
        }
        
        .refresh-badge {
            background: linear-gradient(45deg, #ff6b6b, #feca57);
            color: white;
            animation: pulse 2s infinite;
        }
        
        /* Fixed Wheel Styles */
        .wheel-container {
            position: relative;
            width: 300px;
            height: 300px;
            margin: 0 auto;
        }
        
        .wheel {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: conic-gradient(
                #ff6b6b 0deg 60deg,
                #4ecdc4 60deg 120deg,
                #45b7d1 120deg 180deg,
                #96ceb4 180deg 240deg,
                #feca57 240deg 300deg,
                #ff9ff3 300deg 360deg
            );
            position: relative;
            transition: transform 4s cubic-bezier(0.2, 0.8, 0.3, 1);
            transform: rotate(0deg);
        }
        
        .wheel.spinning {
            animation: wheelSpin 4s cubic-bezier(0.2, 0.8, 0.3, 1) forwards;
        }
        
        @keyframes wheelSpin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(1080deg); } /* 3 full rotations + final position */
        }
        
        .wheel-item {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            transform-origin: center;
            text-align: center;
            color: white;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }
        
        .wheel-item span {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 80px;
        }
        
        .wheel-pointer {
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 15px solid transparent;
            border-right: 15px solid transparent;
            border-top: 30px solid #333;
            z-index: 10;
        }
        
        /* Mobile Navigation */
        .mobile-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            border-top: 1px solid #e5e7eb;
            z-index: 40;
            display: none;
        }
        
        .mobile-nav-item {
            flex: 1;
            text-align: center;
            padding: 0.75rem 0.5rem;
            color: #6b7280;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .mobile-nav-item:hover, .mobile-nav-item.active {
            color: var(--primary-color);
            transform: translateY(-2px);
        }
        
        .mobile-nav-item i {
            font-size: 1.25rem;
            margin-bottom: 0.25rem;
            transition: transform 0.3s ease;
        }
        
        .mobile-nav-item:hover i {
            transform: scale(1.1);
        }
        
        .mobile-nav-item span {
            font-size: 0.75rem;
            display: block;
        }
        
        /* Desktop Sidebar */
        .desktop-sidebar {
            position: fixed;
            left: 0;
            top: 0;
            height: 100vh;
            width: 250px;
            background: white;
            border-right: 1px solid #e5e7eb;
            padding: 1rem;
            z-index: 30;
            transform: translateX(0);
            transition: transform 0.3s ease;
            overflow-y: auto;
        }
        
        .desktop-sidebar.hidden {
            transform: translateX(-100%);
        }
        
        .sidebar-item {
            display: flex;
            align-items: center;
            padding: 0.75rem 1rem;
            margin-bottom: 0.5rem;
            border-radius: 0.5rem;
            color: #6b7280;
            transition: all 0.3s ease;
            text-decoration: none;
            position: relative;
        }
        
        .sidebar-item:hover {
            background-color: #f3f4f6;
            color: var(--primary-color);
            transform: translateX(5px);
        }
        
        .sidebar-item.active {
            background-color: #eff6ff;
            color: var(--primary-color);
            font-weight: 600;
        }
        
        .sidebar-item i {
            width: 20px;
            margin-right: 0.75rem;
            transition: transform 0.3s ease;
        }
        
        .sidebar-item:hover i {
            transform: scale(1.1);
        }
        
        /* Splash screen styles */
        .splash-screen {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 100;
            transition: opacity 0.5s ease;
        }
        
        .splash-screen.hidden {
            opacity: 0;
            pointer-events: none;
        }
        
        .splash-logo {
            animation: bounce 2s infinite;
        }
        
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% {transform: translateY(0);}
            40% {transform: translateY(-30px);}
            60% {transform: translateY(-15px);}
        }
        
        /* Admin dashboard styles */
        .admin-badge {
            background: linear-gradient(45deg, #ff6b6b, #feca57);
            color: white;
        }
        
        /* Progress Bar Styles */
        .progress-bar {
            height: 8px;
            background-color: #e5e7eb;
            border-radius: 4px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.5s ease;
        }
        
        /* Daily Limit Counter Styles */
        .daily-limit-counter {
            background: linear-gradient(45deg, #8b5cf6, #3b82f6);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
        }
        
        /* Achievement Badge Styles */
        .achievement-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 1rem;
        }
        
        .achievement-card {
            text-align: center;
            padding: 1rem;
            border-radius: 0.5rem;
            transition: all 0.3s ease;
        }
        
        .achievement-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }
        
        /* Promotional Banner */
        .promo-banner {
            background: linear-gradient(45deg, #f59e0b, #f97316);
            color: white;
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
            text-align: center;
            animation: pulse 2s infinite;
        }
        
        /* Affiliate Banner Styles */
        .affiliate-banner {
            background: white;
            border-radius: 0.5rem;
            padding: 1rem;
            margin: 1rem 0;
            text-align: center;
            border: 1px solid #e5e7eb;
        }
        
        /* Share Button Styles */
        .share-buttons {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }
        
        .share-btn {
            flex: 1;
            min-width: 100px;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            color: white;
            text-align: center;
            transition: all 0.3s ease;
        }
        
        .share-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        
        .share-whatsapp {
            background-color: #25D366;
        }
        
        .share-facebook {
            background-color: #1877F2;
        }
        
        .share-twitter {
            background-color: #1DA1F2;
        }
        
        /* Social Bar Ads Container */
        .social-bar-ads {
            position: fixed;
            bottom: 70px;
            left: 0;
            right: 0;
            background: #f8f9fa;
            border-top: 1px solid #e5e7eb;
            padding: 10px;
            z-index: 35;
            text-align: center;
        }
        
        /* Landing Page Styles */
        .landing-hero {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .feature-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .feature-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        
        /* Responsive adjustments */
        @media (max-width: 768px) {
            .mobile-nav {
                display: flex;
            }
            
            .desktop-sidebar {
                display: none;
            }
            
            .main-content {
                padding-bottom: 5rem;
                margin-left: 0 !important;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .quick-actions {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .wheel-container {
                width: 250px;
                height: 250px;
            }
            
            .achievement-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .social-bar-ads {
                bottom: 60px;
            }
        }
        
        @media (max-width: 480px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .quick-actions {
                grid-template-columns: 1fr;
            }
            
            .wheel-container {
                width: 200px;
                height: 200px;
            }
            
            .achievement-grid {
                grid-template-columns: 1fr;
            }
            
            .share-buttons {
                flex-direction: column;
            }
        }
    </style>

    <!-- Landing Page Redirect Logic -->
    <script>
        // Check if user should see the external landing page
        document.addEventListener('DOMContentLoaded', function() {
            const hasSeenLanding = localStorage.getItem('eduhetech_seen_landing');
            const isReturningUser = localStorage.getItem('eduhetech_visited');
            const isAuthenticated = localStorage.getItem('eduhetech_user');
            
            // Only redirect new users who haven't seen the landing page
            if (!hasSeenLanding && !isReturningUser && !isAuthenticated) {
                // Set flag to prevent infinite redirects
                localStorage.setItem('eduhetech_seen_landing', 'true');
                
                // Redirect to the external landing page
                setTimeout(() => {
                    window.location.href = 'https://preview-l5r9udgc--learn-earn-community.deploypad.app/';
                }, 1000); // Small delay to show splash screen briefly
            }
        });
    </script>
</head>
<body class="text-gray-800">

    <!-- Splash Screen -->
    <div id="splash-screen" class="splash-screen">
        <div class="text-center text-white">
            <div class="splash-logo mb-8">
                <i class="fas fa-graduation-cap text-6xl mb-4"></i>
                <h1 class="text-5xl font-bold">EduHeTech</h1>
            </div>
            <p class="text-xl opacity-90">Learn • Earn • Grow</p>
            <div class="mt-8">
                <div class="loader mx-auto border-white"></div>
            </div>
        </div>
    </div>

    <!-- Global Loading Spinner -->
    <div id="global-loader" class="fixed inset-0 bg-white bg-opacity-80 flex items-center justify-center hidden z-50">
        <div class="loader"></div>
    </div>

    <!-- Global Modal Structure -->
    <div id="global-modal" class="modal-overlay fixed inset-0 hidden flex items-center justify-center p-4 z-40">
        <div class="card w-full max-w-sm p-6 space-y-4 slide-in">
            <div id="modal-content"></div>
            <div class="flex justify-end space-x-2">
                <button id="modal-cancel" onclick="hideModal()" class="p-2 px-4 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition">Cancel</button>
                <button id="modal-confirm" class="p-2 px-4 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition hidden">Confirm</button>
            </div>
        </div>
    </div>

    <!-- Desktop Sidebar -->
    <div id="desktop-sidebar" class="desktop-sidebar">
        <div class="mb-8">
            <h1 class="text-2xl font-bold text-blue-600">EduHeTech</h1>
            <p class="text-sm text-gray-600">Learn • Earn • Grow</p>
        </div>
        
        <nav class="space-y-1">
            <a href="#dashboard" class="sidebar-item active" data-view="dashboard">
                <i class="fas fa-home"></i>
                <span>Dashboard</span>
            </a>
            <a href="#learn" class="sidebar-item" data-view="learn">
                <i class="fas fa-book"></i>
                <span>Learn</span>
            </a>
            <a href="#quiz" class="sidebar-item" data-view="quiz">
                <i class="fas fa-brain"></i>
                <span>Quiz</span>
            </a>
            <a href="#ads" class="sidebar-item" data-view="ads">
                <i class="fas fa-ad"></i>
                <span>Watch Ads</span>
            </a>
            <a href="#spin" class="sidebar-item" data-view="spin">
                <i class="fas fa-sync-alt"></i>
                <span>Spin Wheel</span>
            </a>
            <a href="#videos" class="sidebar-item" data-view="videos">
                <i class="fas fa-play-circle"></i>
                <span>Watch & Earn</span>
            </a>
            <a href="#missions" class="sidebar-item" data-view="missions">
                <i class="fas fa-tasks"></i>
                <span>Daily Missions</span>
            </a>
            <a href="#blog" class="sidebar-item" data-view="blog">
                <i class="fas fa-blog"></i>
                <span>Blog</span>
            </a>
            <a href="#premium" class="sidebar-item" data-view="premium">
                <i class="fas fa-crown"></i>
                <span>Go Premium</span>
            </a>
            <a href="#social" class="sidebar-item" data-view="social">
                <i class="fas fa-users"></i>
                <span>Community</span>
            </a>
            <a href="#referral" class="sidebar-item" data-view="referral">
                <i class="fas fa-users"></i>
                <span>Refer & Earn</span>
            </a>
            <a href="#rewards" class="sidebar-item" data-view="rewards">
                <i class="fas fa-wallet"></i>
                <span>Wallet</span>
            </a>
            <a href="#leaderboard" class="sidebar-item" data-view="leaderboard">
                <i class="fas fa-trophy"></i>
                <span>Leaderboard</span>
            </a>
            <a href="#achievements" class="sidebar-item" data-view="achievements">
                <i class="fas fa-medal"></i>
                <span>Achievements</span>
            </a>
        </nav>
        
        <!-- Footer Links in Sidebar -->
        <div class="absolute bottom-20 left-4 right-4 text-xs text-gray-500">
            <div class="flex flex-wrap gap-2 mb-2">
                <a href="terms.html" class="hover:text-blue-500 transition">Terms</a>
                <a href="privacy.html" class="hover:text-blue-500 transition">Privacy</a>
                <a href="faq.html" class="hover:text-blue-500 transition">FAQ</a>
            </div>
            <p>&copy; 2024 EduHeTech. All rights reserved.</p>
        </div>
        
        <div class="absolute bottom-4 left-4 right-4">
            <button onclick="handleFirebaseLogout()" class="w-full bg-red-500 hover:bg-red-600 text-white py-2 rounded-lg transition flex items-center justify-center">
                <i class="fas fa-sign-out-alt mr-2"></i>
                Logout
            </button>
        </div>
    </div>

    <!-- Application Root -->
    <div id="app">
        <!-- Content will be rendered here by JavaScript -->
    </div>

    <!-- Social Bar Ads -->
    <div id="social-bar-ads" class="social-bar-ads hidden">
        <!-- Social bar ads script will be loaded here -->
    </div>

    <!-- Mobile Navigation - Only visible when user is logged in -->
    <div id="mobile-nav" class="mobile-nav hidden">
        <a href="#dashboard" class="mobile-nav-item active" data-view="dashboard">
            <i class="fas fa-home"></i>
            <span>Dashboard</span>
        </a>
        <a href="#learn" class="mobile-nav-item" data-view="learn">
            <i class="fas fa-book"></i>
            <span>Learn</span>
        </a>
        <a href="#quiz" class="mobile-nav-item" data-view="quiz">
            <i class="fas fa-brain"></i>
            <span>Quiz</span>
        </a>
        <a href="#ads" class="mobile-nav-item" data-view="ads">
            <i class="fas fa-ad"></i>
            <span>Ads</span>
        </a>
        <a href="#spin" class="mobile-nav-item" data-view="spin">
            <i class="fas fa-sync-alt"></i>
            <span>Spin</span>
        </a>
        <a href="#rewards" class="mobile-nav-item" data-view="rewards">
            <i class="fas fa-wallet"></i>
            <span>Wallet</span>
        </a>
    </div>

    <!-- Popunder Ads Script -->
    <script type='text/javascript' src='//pl27966799.effectivegatecpm.com/40/24/3e/40243ef8e672d1397093cc2261cb9329.js'></script>

    <!-- Social Bar Ads Script -->
    <script type='text/javascript' src='//pl27966780.effectivegatecpm.com/1d/1e/fd/1d1efd5b3352a83d3a15c08814ecc32e.js'></script>

    <!-- Lazy-loaded Firebase SDK -->
    <script>
        // Function to load Firebase SDK after page load
        function loadFirebaseSDK() {
            const script = document.createElement('script');
            script.type = 'module';
            script.innerHTML = `
                // Import Firebase modules
                import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
                import { 
                    getAuth, 
                    createUserWithEmailAndPassword, 
                    signInWithEmailAndPassword, 
                    signOut, 
                    onAuthStateChanged
                } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
                import { 
                    getFirestore, 
                    doc, 
                    setDoc, 
                    getDoc, 
                    updateDoc, 
                    collection, 
                    query, 
                    where, 
                    getDocs, 
                    addDoc, 
                    orderBy, 
                    limit
                } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

                // Your Firebase configuration
                const firebaseConfig = {
                    apiKey: "AIzaSyDDKcWF9bOA9aSZOkeODE_N8Ag_wS87J_0",
                    authDomain: "studio-4004347076-d761a.firebaseapp.com",
                    projectId: "studio-4004347076-d761a",
                    storageBucket: "studio-4004347076-d761a.firebasestorage.app",
                    messagingSenderId: "316122123573",
                    appId: "1:316122123573:web:b36fe06376e37948ea907c"
                };

                // Initialize Firebase
                const app = initializeApp(firebaseConfig);
                const auth = getAuth(app);
                const db = getFirestore(app);

                // Make Firebase available globally
                window.firebaseAuth = auth;
                window.firebaseDb = db;
                window.firebaseApp = app;
                window.firebaseModules = {
                    createUserWithEmailAndPassword,
                    signInWithEmailAndPassword,
                    signOut,
                    onAuthStateChanged,
                    doc,
                    setDoc,
                    getDoc,
                    updateDoc,
                    collection,
                    query,
                    where,
                    getDocs,
                    addDoc,
                    orderBy,
                    limit
                };

                console.log("Firebase initialized successfully!");
                
                // Initialize the app after Firebase is loaded
                window.firebaseReady = true;
                if (window.initApp) {
                    window.initApp();
                }
            `;
            document.head.appendChild(script);
        }

        // Load Firebase SDK after page load
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', loadFirebaseSDK);
        } else {
            loadFirebaseSDK();
        }
    </script>

    <script>
        // =====================================================
        // APPLICATION CONSTANTS AND STATE
        // =====================================================
        
        // Firebase Collections
        const FIRESTORE_COLLECTIONS = {
            USERS: 'users',
            WITHDRAWALS: 'withdrawals',
            LESSONS: 'lessons',
            QUIZZES: 'quizzes',
            ACHIEVEMENTS: 'achievements',
            LEADERBOARD: 'leaderboard',
            NOTIFICATIONS: 'notifications'
        };

        // Monetag Smart Links
        const MONETAG_SMART_LINKS = [
            'https://otieu.com/4/10070319',
            'https://otieu.com/4/10070318',
            'https://otieu.com/4/10070317',
            'https://otieu.com/4/10070316',
            'https://otieu.com/4/10070315',
            'https://otieu.com/4/10070314',
            'https://otieu.com/4/7667810',
            'https://otieu.com/4/7667811',
            'https://otieu.com/4/7667754',
            'https://otieu.com/4/7667716'
        ];

        // Admin Configuration
        const ADMIN_CONFIG = {
            ADMIN_EMAILS: ['admin@eduhetech.com'],
            MIN_WITHDRAWAL_AMOUNT: 500000,
            POINTS_TO_CURRENCY_RATE: 100000 // 100,000 EduPoints = $1
        };

        // Updated point rewards as specified
        const BASE_POINTS_REWARDS = {
            lesson: 500,
            quiz: 200,
            ad: 100,
            quickAd: 50,
            premiumAd: 200,
            dailyLogin: 100,
            referral: 1000,
            streak: 500,
            achievement: 1000,
            video: 150,
            spin: 100
        };
        
        const MIN_WITHDRAWAL_POINTS = 500000; // 500,000 EduPoints = $5
        const DAILY_POINTS_LIMIT = 10000; // 10,000 EduPoints daily limit (excluding referral bonuses)

        // Wheel prizes
        const WHEEL_PRIZES = [
            { value: 50, label: '50 Points', type: 'points' },
            { value: 100, label: '100 Points', type: 'points' },
            { value: 'ad', label: 'Watch Ad', type: 'ad' },
            { value: 200, label: '200 Points', type: 'points' },
            { value: 500, label: '500 Points', type: 'points' },
            { value: 'ad', label: 'Watch Ad', type: 'ad' }
        ];

        // Global State Management
        window.state = {
            user: null,
            currentView: 'loading',
            isLoading: false,
            quizData: null,
            withdrawalRequests: [],
            lessons: [],
            quizzes: [],
            achievements: [],
            notifications: [],
            currentCourse: null,
            firebaseUser: null,
            isAdmin: false,
            currentMonetagLink: '',
            adTimer: null,
            adTimerActive: false,
            adTimerSeconds: 0,
            referralCode: getUrlParameter('ref'), // Get referral code from URL
            lastSpinDate: null,
            missions: {},
            isPremium: false
        };

        // =====================================================
        // UTILITY FUNCTIONS
        // =====================================================

        function getUrlParameter(name) {
            name = name.replace(/[[]/, '\\[').replace(/[\]]/, '\\]');
            const regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
            const results = regex.exec(location.search);
            return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
        }

        function generateReferralCode() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let result = '';
            for (let i = 0; i < 8; i++) {
                result += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return result;
        }

        function formatPoints(points) {
            return points?.toLocaleString() || '0';
        }

        function calculateStreak(loginDates) {
            if (!loginDates || loginDates.length === 0) return 0;
            
            const sortedDates = [...loginDates].sort((a, b) => new Date(b) - new Date(a));
            let streak = 1;
            let currentDate = new Date(sortedDates[0]);
            
            for (let i = 1; i < sortedDates.length; i++) {
                const prevDate = new Date(currentDate);
                prevDate.setDate(prevDate.getDate() - 1);
                
                const checkDate = new Date(sortedDates[i]);
                if (checkDate.toDateString() === prevDate.toDateString()) {
                    streak++;
                    currentDate = checkDate;
                } else {
                    break;
                }
            }
            
            return streak;
        }

        function hasReachedDailyLimit(user) {
            if (!user.history) return false;
            
            const today = new Date().toDateString();
            const todayEarnings = user.history
                .filter(entry => {
                    const entryDate = new Date(entry.timestamp).toDateString();
                    return entryDate === today && 
                           entry.points > 0 && 
                           !entry.action.includes('Referral'); // Exclude referral bonuses
                })
                .reduce((sum, entry) => sum + entry.points, 0);
            
            return todayEarnings >= DAILY_POINTS_LIMIT;
        }

        function getTodaysEarnings() {
            if (!state.user || !state.user.history) return 0;
            
            const today = new Date().toDateString();
            return state.user.history
                .filter(entry => {
                    const entryDate = new Date(entry.timestamp).toDateString();
                    return entryDate === today && 
                           entry.points > 0 && 
                           !entry.action.includes('Referral'); // Exclude referral bonuses
                })
                .reduce((sum, entry) => sum + entry.points, 0);
        }

        function showLoading(show) {
            const loader = document.getElementById('global-loader');
            if (loader) {
                loader.style.display = show ? 'flex' : 'none';
            }
        }

        function showModal(content, onConfirm = null, onCancel = null) {
            const modal = document.getElementById('global-modal');
            const modalContent = document.getElementById('modal-content');
            const modalConfirm = document.getElementById('modal-confirm');
            const modalCancel = document.getElementById('modal-cancel');

            if (!modal || !modalContent) return;

            modalContent.innerHTML = content;
            modal.classList.remove('hidden');

            if (onConfirm) {
                modalConfirm.classList.remove('hidden');
                modalConfirm.onclick = () => {
                    onConfirm();
                    modal.classList.add('hidden');
                    modalConfirm.onclick = null;
                };
            } else {
                modalConfirm.classList.add('hidden');
                modalConfirm.onclick = null;
            }

            if (onCancel) {
                modalCancel.classList.remove('hidden');
                modalCancel.onclick = () => {
                    onCancel();
                    modal.classList.add('hidden');
                    modalCancel.onclick = null;
                };
            } else {
                modalCancel.classList.add('hidden');
                modalCancel.onclick = null;
            }
        }

        function hideModal() {
            document.getElementById('global-modal').classList.add('hidden');
        }

        function updateBrowserTitle() {
            const viewTitles = {
                'dashboard': 'Dashboard',
                'learn': 'Learn',
                'quiz': 'Quiz',
                'ads': 'Watch Ads',
                'spin': 'Spin Wheel',
                'videos': 'Watch & Earn',
                'missions': 'Daily Missions',
                'blog': 'Blog',
                'premium': 'Go Premium',
                'social': 'Community',
                'referral': 'Refer & Earn',
                'rewards': 'Withdraw',
                'leaderboard': 'Leaderboard',
                'achievements': 'Achievements'
            };
            
            const title = viewTitles[state.currentView] || 'EduHeTech';
            document.title = `${title} - EduHeTech`;
        }

        function switchView(view) {
            state.currentView = view;
            render();
            updateSidebar();
        }

        function updateSidebar() {
            const sidebarItems = document.querySelectorAll('.sidebar-item');
            sidebarItems.forEach(item => {
                const view = item.getAttribute('data-view');
                if (view === state.currentView) {
                    item.classList.add('active');
                } else {
                    item.classList.remove('active');
                }
            });
        }

        function updateMobileNav() {
            const navItems = document.querySelectorAll('.mobile-nav-item');
            navItems.forEach(item => {
                if (item.getAttribute('data-view') === state.currentView) {
                    item.classList.add('active');
                } else {
                    item.classList.remove('active');
                }
            });
        }

        // =====================================================
        // LANDING PAGE FUNCTIONS
        // =====================================================

        function showLandingPage() {
            // Check if user should see landing page
            const hasSeenLanding = localStorage.getItem('eduhetech_seen_landing');
            const isReturningUser = localStorage.getItem('eduhetech_visited');
            const isAuthenticated = state.user !== null;

            // Show landing page only for new users who haven't seen it
            if (!hasSeenLanding && !isReturningUser && !isAuthenticated) {
                const appContainer = document.getElementById('app');
                appContainer.innerHTML = renderLandingPage();
                return true;
            }
            return false;
        }

        function renderLandingPage() {
            return `
                <div class="min-h-screen bg-white">
                    <!-- Header -->
                    <header class="bg-white shadow-sm sticky top-0 z-20">
                        <div class="max-w-7xl mx-auto px-4 py-4">
                            <div class="flex justify-between items-center">
                                <div class="flex items-center">
                                    <i class="fas fa-graduation-cap text-2xl text-blue-600 mr-3"></i>
                                    <h1 class="text-2xl font-bold text-blue-600">EduHeTech</h1>
                                </div>
                                <button onclick="hideLandingPage()" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-lg font-semibold transition transform hover:scale-105">
                                    Get Started
                                </button>
                            </div>
                        </div>
                    </header>

                    <!-- Hero Section -->
                    <section class="landing-hero py-20 px-4">
                        <div class="max-w-7xl mx-auto text-center">
                            <h2 class="text-4xl md:text-6xl font-bold mb-6">
                                Learn Skills.<br>
                                <span class="text-yellow-300">Earn Rewards.</span>
                            </h2>
                            <p class="text-xl md:text-2xl opacity-90 mb-8 max-w-3xl mx-auto">
                                Transform your learning journey into earning opportunities. 
                                Study valuable courses, take quizzes, and get rewarded for your progress.
                            </p>
                            
                            <div class="flex flex-col sm:flex-row gap-4 justify-center mb-12">
                                <button onclick="hideLandingPage()" class="bg-white text-blue-600 hover:bg-gray-100 font-bold py-4 px-8 rounded-lg text-lg transition transform hover:scale-105">
                                    Start Learning & Earning
                                </button>
                                <button onclick="scrollToFeatures()" class="border-2 border-white text-white hover:bg-white hover:text-blue-600 font-bold py-4 px-8 rounded-lg text-lg transition">
                                    Learn More
                                </button>
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-3 gap-8 max-w-5xl mx-auto">
                                <div class="bg-white bg-opacity-10 backdrop-blur-sm rounded-xl p-6 feature-card">
                                    <i class="fas fa-users text-4xl text-yellow-300 mb-4"></i>
                                    <h3 class="text-xl font-semibold mb-2">10,000+ Learners</h3>
                                    <p class="opacity-90">Join our growing community of motivated learners</p>
                                </div>
                                <div class="bg-white bg-opacity-10 backdrop-blur-sm rounded-xl p-6 feature-card">
                                    <i class="fas fa-coins text-4xl text-yellow-300 mb-4"></i>
                                    <h3 class="text-xl font-semibold mb-2">₦5M+ Earned</h3>
                                    <p class="opacity-90">Total rewards distributed to our community</p>
                                </div>
                                <div class="bg-white bg-opacity-10 backdrop-blur-sm rounded-xl p-6 feature-card">
                                    <i class="fas fa-star text-4xl text-yellow-300 mb-4"></i>
                                    <h3 class="text-xl font-semibold mb-2">4.8/5 Rating</h3>
                                    <p class="opacity-90">Rated excellent by our users</p>
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- Features Section -->
                    <section id="features" class="py-20 px-4 bg-gray-50">
                        <div class="max-w-7xl mx-auto">
                            <h2 class="text-3xl md:text-4xl font-bold text-center text-gray-800 mb-4">How It Works</h2>
                            <p class="text-xl text-gray-600 text-center mb-12 max-w-2xl mx-auto">
                                Simple steps to start earning while learning
                            </p>

                            <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-16">
                                <div class="text-center feature-card card p-8">
                                    <div class="w-20 h-20 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-6">
                                        <i class="fas fa-user-plus text-3xl text-blue-600"></i>
                                    </div>
                                    <h3 class="text-xl font-semibold mb-3">1. Sign Up</h3>
                                    <p class="text-gray-600">Create your free account and get welcome bonus points</p>
                                </div>
                                
                                <div class="text-center feature-card card p-8">
                                    <div class="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6">
                                        <i class="fas fa-book text-3xl text-green-600"></i>
                                    </div>
                                    <h3 class="text-xl font-semibold mb-3">2. Learn & Quiz</h3>
                                    <p class="text-gray-600">Complete courses and quizzes to earn points</p>
                                </div>
                                
                                <div class="text-center feature-card card p-8">
                                    <div class="w-20 h-20 bg-yellow-100 rounded-full flex items-center justify-center mx-auto mb-6">
                                        <i class="fas fa-wallet text-3xl text-yellow-600"></i>
                                    </div>
                                    <h3 class="text-xl font-semibold mb-3">3. Earn & Withdraw</h3>
                                    <p class="text-gray-600">Convert your points to real money</p>
                                </div>
                            </div>

                            <!-- Feature Grid -->
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                                <div class="feature-card card p-6 text-center">
                                    <i class="fas fa-book text-4xl text-blue-500 mb-4"></i>
                                    <h3 class="text-lg font-semibold mb-2">Learn Courses</h3>
                                    <p class="text-gray-600 text-sm">Access curated educational content across multiple categories</p>
                                </div>
                                
                                <div class="feature-card card p-6 text-center">
                                    <i class="fas fa-brain text-4xl text-green-500 mb-4"></i>
                                    <h3 class="text-lg font-semibold mb-2">Take Quizzes</h3>
                                    <p class="text-gray-600 text-sm">Test your knowledge and earn points for correct answers</p>
                                </div>
                                
                                <div class="feature-card card p-6 text-center">
                                    <i class="fas fa-ad text-4xl text-purple-500 mb-4"></i>
                                    <h3 class="text-lg font-semibold mb-2">Watch Ads</h3>
                                    <p class="text-gray-600 text-sm">Earn points by watching short advertisements</p>
                                </div>
                                
                                <div class="feature-card card p-6 text-center">
                                    <i class="fas fa-sync-alt text-4xl text-orange-500 mb-4"></i>
                                    <h3 class="text-lg font-semibold mb-2">Spin Wheel</h3>
                                    <p class="text-gray-600 text-sm">Daily spin for bonus points and rewards</p>
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- CTA Section -->
                    <section class="py-20 px-4 bg-gradient-to-r from-blue-600 to-purple-600 text-white">
                        <div class="max-w-4xl mx-auto text-center">
                            <h2 class="text-3xl md:text-4xl font-bold mb-6">Ready to Start Your Journey?</h2>
                            <p class="text-xl opacity-90 mb-8">
                                Join thousands of learners who are already earning while building valuable skills
                            </p>
                            <button onclick="hideLandingPage()" class="bg-white text-blue-600 hover:bg-gray-100 font-bold py-4 px-12 rounded-lg text-lg transition transform hover:scale-105">
                                Get Started Now
                            </button>
                            <p class="text-sm opacity-80 mt-4">No credit card required • Free to join</p>
                        </div>
                    </section>

                    <!-- Footer -->
                    <footer class="bg-gray-800 text-white py-12 px-4">
                        <div class="max-w-7xl mx-auto">
                            <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
                                <div>
                                    <h3 class="text-xl font-bold mb-4">EduHeTech</h3>
                                    <p class="text-gray-400">Learn valuable skills and earn rewards through our innovative platform.</p>
                                </div>
                                <div>
                                    <h4 class="font-semibold mb-4">Quick Links</h4>
                                    <ul class="space-y-2 text-gray-400">
                                        <li><a href="#" class="hover:text-white transition">Home</a></li>
                                        <li><a href="#features" class="hover:text-white transition">Features</a></li>
                                        <li><a href="#" class="hover:text-white transition">About</a></li>
                                    </ul>
                                </div>
                                <div>
                                    <h4 class="font-semibold mb-4">Support</h4>
                                    <ul class="space-y-2 text-gray-400">
                                        <li><a href="#" class="hover:text-white transition">Help Center</a></li>
                                        <li><a href="#" class="hover:text-white transition">Contact Us</a></li>
                                        <li><a href="#" class="hover:text-white transition">Privacy Policy</a></li>
                                    </ul>
                                </div>
                                <div>
                                    <h4 class="font-semibold mb-4">Connect</h4>
                                    <div class="flex space-x-4">
                                        <a href="#" class="text-gray-400 hover:text-white transition">
                                            <i class="fab fa-facebook text-xl"></i>
                                        </a>
                                        <a href="#" class="text-gray-400 hover:text-white transition">
                                            <i class="fab fa-twitter text-xl"></i>
                                        </a>
                                        <a href="#" class="text-gray-400 hover:text-white transition">
                                            <i class="fab fa-instagram text-xl"></i>
                                        </a>
                                    </div>
                                </div>
                            </div>
                            <div class="border-t border-gray-700 mt-8 pt-8 text-center text-gray-400">
                                <p>&copy; 2024 EduHeTech. All rights reserved.</p>
                            </div>
                        </div>
                    </footer>
                </div>
            `;
        }

        function hideLandingPage() {
            // Mark landing page as seen
            localStorage.setItem('eduhetech_seen_landing', 'true');
            
            // Show authentication screen
            state.currentView = 'auth';
            render();
        }

        function scrollToFeatures() {
            document.getElementById('features').scrollIntoView({ 
                behavior: 'smooth' 
            });
        }

        // =====================================================
        // SPLASH SCREEN & INITIALIZATION
        // =====================================================

        function hideSplashScreen() {
            const splashScreen = document.getElementById('splash-screen');
            if (splashScreen) {
                splashScreen.classList.add('hidden');
                // Remove from DOM after animation
                setTimeout(() => {
                    splashScreen.style.display = 'none';
                }, 500);
            }
        }

        function initializeApp() {
            console.log("Initializing EduHeTech application...");
            
            // Check if we should show landing page
            if (showLandingPage()) {
                hideSplashScreen();
                return;
            }
            
            // Check if user has visited before
            const hasVisitedBefore = localStorage.getItem('eduhetech_visited');
            
            // Show splash screen for only 1.5 seconds for returning users, 2 seconds for new users
            const splashTime = hasVisitedBefore ? 1500 : 2000;
            
            setTimeout(() => {
                hideSplashScreen();
                initializeAuthStateListener();
                
                // Mark as visited
                if (!hasVisitedBefore) {
                    localStorage.setItem('eduhetech_visited', 'true');
                }
            }, splashTime);
        }

        // =====================================================
        // FIREBASE AUTHENTICATION FUNCTIONS
        // =====================================================

        async function handleFirebaseSignup(name, email, password, referrerCode = null) {
            try {
                showLoading(true);
                
                const { createUserWithEmailAndPassword, doc, setDoc } = window.firebaseModules;
                const auth = window.firebaseAuth;
                const db = window.firebaseDb;
                
                // Create user in Firebase Authentication
                const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                const firebaseUser = userCredential.user;
                
                // Generate unique referral code
                const referralCode = generateReferralCode();
                
                // Create user profile in Firestore
                const userData = {
                    uid: firebaseUser.uid,
                    name: name,
                    email: email,
                    eduPoints: 1000, // Starting bonus
                    referralCount: 0,
                    referralCode: referralCode,
                    lastLogin: Date.now(),
                    loginDates: [new Date().toDateString()],
                    history: [{ 
                        action: 'Welcome Bonus', 
                        points: 1000, 
                        timestamp: Date.now() 
                    }],
                    achievements: [],
                    completedCourses: {},
                    completedQuizzes: {},
                    completedCoursesToday: {},
                    lastCourseReset: new Date().toDateString(),
                    streak: 1,
                    lastSpinDate: null,
                    missions: {
                        adsWatched: 0,
                        coursesCompleted: 0,
                        referrals: 0
                    },
                    isPremium: false,
                    createdAt: Date.now(),
                    updatedAt: Date.now()
                };

                // Save to Firestore
                await setDoc(doc(db, FIRESTORE_COLLECTIONS.USERS, firebaseUser.uid), userData);
                
                // Handle referral if applicable - BOTH referrer and referred get bonuses
                if (referrerCode) {
                    await handleReferral(referrerCode, firebaseUser.uid);
                }

                // Update local state
                state.firebaseUser = firebaseUser;
                state.user = userData;
                state.isAdmin = ADMIN_CONFIG.ADMIN_EMAILS.includes(email);
                
                showModal(`
                    <div class="text-center space-y-3">
                        <i class="fas fa-check-circle text-5xl text-green-500"></i>
                        <h3 class="text-xl font-bold text-green-600">Account Created!</h3>
                        <p class="text-gray-600">Welcome to EduHeTech, ${name}!</p>
                        <p class="text-sm text-green-600">You received 1000 welcome bonus points!</p>
                        ${referrerCode ? `<p class="text-sm text-blue-600">Referral bonus applied! You received 500 extra points!</p>` : ''}
                    </div>
                `, () => {
                    setTimeout(hideModal, 2000);
                    state.currentView = 'dashboard';
                    render();
                });

            } catch (error) {
                console.error("Signup error:", error);
                handleAuthError(getFirebaseErrorMessage(error));
            } finally {
                showLoading(false);
            }
        }

        async function handleFirebaseLogin(email, password) {
            try {
                showLoading(true);
                
                const { signInWithEmailAndPassword, doc, getDoc, updateDoc } = window.firebaseModules;
                const auth = window.firebaseAuth;
                const db = window.firebaseDb;
                
                const userCredential = await signInWithEmailAndPassword(auth, email, password);
                const firebaseUser = userCredential.user;
                
                // Get user data from Firestore
                const userDoc = await getDoc(doc(db, FIRESTORE_COLLECTIONS.USERS, firebaseUser.uid));
                
                if (!userDoc.exists()) {
                    throw new Error('User data not found. Please contact support.');
                }
                
                const userData = userDoc.data();
                
                // Update login info
                const today = new Date().toDateString();
                const lastLoginDate = new Date(userData.lastLogin).toDateString();
                
                if (today !== lastLoginDate) {
                    if (!userData.loginDates) userData.loginDates = [];
                    if (!userData.loginDates.includes(today)) {
                        userData.loginDates.push(today);
                    }
                    
                    // Add daily login bonus
                    const streak = calculateStreak(userData.loginDates);
                    userData.streak = streak;
                    
                    if (!hasReachedDailyLimit(userData)) {
                        userData.eduPoints += BASE_POINTS_REWARDS.dailyLogin;
                        userData.history.push({
                            action: 'Daily Login Bonus',
                            points: BASE_POINTS_REWARDS.dailyLogin,
                            timestamp: Date.now()
                        });
                    }
                    
                    userData.lastLogin = Date.now();
                    
                    // Update in Firestore
                    await updateDoc(doc(db, FIRESTORE_COLLECTIONS.USERS, firebaseUser.uid), {
                        loginDates: userData.loginDates,
                        streak: userData.streak,
                        eduPoints: userData.eduPoints,
                        history: userData.history,
                        lastLogin: userData.lastLogin,
                        updatedAt: Date.now()
                    });
                }

                // Update local state
                state.firebaseUser = firebaseUser;
                state.user = userData;
                state.isAdmin = ADMIN_CONFIG.ADMIN_EMAILS.includes(email);
                state.lastSpinDate = userData.lastSpinDate;
                state.missions = userData.missions || {};
                state.isPremium = userData.isPremium || false;
                
                // Initialize app data
                await initializeAppData();
                
                state.currentView = 'dashboard';
                render();

            } catch (error) {
                console.error("Login error:", error);
                handleAuthError(getFirebaseErrorMessage(error));
            } finally {
                showLoading(false);
            }
        }

        async function handleFirebaseLogout() {
            try {
                showLoading(true);
                const { signOut } = window.firebaseModules;
                const auth = window.firebaseAuth;
                
                await signOut(auth);
                state.firebaseUser = null;
                state.user = null;
                state.isAdmin = false;
                state.currentView = 'auth';
                render();
            } catch (error) {
                console.error("Logout error:", error);
                showModal(`
                    <div class="text-center space-y-3">
                        <i class="fas fa-exclamation-triangle text-5xl text-red-500"></i>
                        <h3 class="text-xl font-bold text-red-600">Logout Error</h3>
                        <p class="text-gray-600">${error.message}</p>
                    </div>
                `);
            } finally {
                showLoading(false);
            }
        }

        async function handleReferral(referrerCode, newUserId) {
            try {
                const { collection, query, where, getDocs, doc, updateDoc, getDoc } = window.firebaseModules;
                const db = window.firebaseDb;
                
                // Find referrer by referral code
                const referrersSnapshot = await getDocs(
                    query(collection(db, FIRESTORE_COLLECTIONS.USERS), where('referralCode', '==', referrerCode))
                );
                
                if (!referrersSnapshot.empty) {
                    const referrerDoc = referrersSnapshot.docs[0];
                    const referrerData = referrerDoc.data();
                    
                    // Update referrer's data - REFERRER GETS BONUS
                    const newReferralCount = (referrerData.referralCount || 0) + 1;
                    const newPoints = referrerData.eduPoints + BASE_POINTS_REWARDS.referral;
                    
                    await updateDoc(doc(db, FIRESTORE_COLLECTIONS.USERS, referrerDoc.id), {
                        referralCount: newReferralCount,
                        eduPoints: newPoints,
                        history: [
                            ...(referrerData.history || []),
                            {
                                action: 'Referral Bonus',
                                points: BASE_POINTS_REWARDS.referral,
                                timestamp: Date.now()
                            }
                        ],
                        updatedAt: Date.now()
                    });
                    
                    // Also update new user's data to track who referred them
                    await updateDoc(doc(db, FIRESTORE_COLLECTIONS.USERS, newUserId), {
                        referredBy: referrerDoc.id,
                        updatedAt: Date.now()
                    });
                    
                    // Give bonus to new user as well - REFERRED USER GETS BONUS TOO
                    const newUserDoc = await getDoc(doc(db, FIRESTORE_COLLECTIONS.USERS, newUserId));
                    if (newUserDoc.exists()) {
                        const newUserData = newUserDoc.data();
                        await updateDoc(doc(db, FIRESTORE_COLLECTIONS.USERS, newUserId), {
                            eduPoints: newUserData.eduPoints + 500, // Extra bonus for using referral
                            history: [
                                ...(newUserData.history || []),
                                {
                                    action: 'Referral Signup Bonus',
                                    points: 500,
                                    timestamp: Date.now()
                                }
                            ]
                        });
                    }
                    
                    return true;
                }
                return false;
            } catch (error) {
                console.error("Referral error:", error);
                return false;
            }
        }

        function getFirebaseErrorMessage(error) {
            const errorMap = {
                'auth/email-already-in-use': 'This email is already registered.',
                'auth/invalid-email': 'Please enter a valid email address.',
                'auth/operation-not-allowed': 'Email/password accounts are not enabled.',
                'auth/weak-password': 'Password should be at least 6 characters.',
                'auth/user-disabled': 'This account has been disabled.',
                'auth/user-not-found': 'No account found with this email.',
                'auth/wrong-password': 'Incorrect password.',
                'auth/too-many-requests': 'Too many attempts. Please try again later.'
            };
            
            return errorMap[error.code] || error.message || 'An error occurred. Please try again.';
        }

        // Auth State Listener
        function initializeAuthStateListener() {
            const { onAuthStateChanged, doc, getDoc } = window.firebaseModules;
            const auth = window.firebaseAuth;
            const db = window.firebaseDb;
            
            onAuthStateChanged(auth, async (firebaseUser) => {
                if (firebaseUser) {
                    // User is signed in
                    try {
                        showLoading(true);
                        const userDoc = await getDoc(doc(db, FIRESTORE_COLLECTIONS.USERS, firebaseUser.uid));
                        
                        if (userDoc.exists()) {
                            state.firebaseUser = firebaseUser;
                            state.user = userDoc.data();
                            state.isAdmin = ADMIN_CONFIG.ADMIN_EMAILS.includes(state.user.email);
                            state.lastSpinDate = state.user.lastSpinDate;
                            state.missions = state.user.missions || {};
                            state.isPremium = state.user.isPremium || false;
                            
                            // Initialize app data
                            await initializeAppData();
                            
                            state.currentView = 'dashboard';
                            render();
                        } else {
                            // User document doesn't exist - sign them out
                            const { signOut } = window.firebaseModules;
                            await signOut(auth);
                            state.firebaseUser = null;
                            state.user = null;
                            state.isAdmin = false;
                            state.currentView = 'auth';
                            showModal(`
                                <div class="text-center space-y-3">
                                    <i class="fas fa-exclamation-triangle text-5xl text-red-500"></i>
                                    <h3 class="text-xl font-bold text-red-600">Account Error</h3>
                                    <p class="text-gray-600">Your account data was not found. Please contact support.</p>
                                </div>
                            `);
                            render();
                        }
                    } catch (error) {
                        console.error("Error loading user data:", error);
                        state.currentView = 'auth';
                        render();
                    } finally {
                        showLoading(false);
                    }
                } else {
                    // User is signed out
                    state.firebaseUser = null;
                    state.user = null;
                    state.isAdmin = false;
                    state.currentView = 'auth';
                    render();
                }
            });
        }

        // =====================================================
        // MONETAG SMART LINK FUNCTIONS
        // =====================================================

        function getRandomMonetagLink() {
            const randomIndex = Math.floor(Math.random() * MONETAG_SMART_LINKS.length);
            return MONETAG_SMART_LINKS[randomIndex];
        }

        function updateMonetagLink() {
            state.currentMonetagLink = getRandomMonetagLink();
        }

        function startAdTimer(duration = 30, points = BASE_POINTS_REWARDS.ad) {
            state.adTimerSeconds = duration;
            state.adTimerActive = true;
            
            // Show timer modal
            showModal(`
                <div class="text-center space-y-4">
                    <i class="fas fa-ad text-5xl text-purple-500 mb-2"></i>
                    <h3 class="text-xl font-bold">Watch Ad to Earn Points</h3>
                    <p class="text-gray-600">Please watch the ad for <span id="ad-timer-seconds">${duration}</span> seconds to earn ${points} points.</p>
                    <div class="bg-purple-50 p-4 rounded-lg">
                        <p class="text-sm font-semibold text-purple-800">Important:</p>
                        <p class="text-sm text-purple-700">Do not close this window or navigate away, or you won't receive points!</p>
                    </div>
                    <div class="flex justify-center">
                        <div class="bg-gray-200 rounded-full h-4 w-full">
                            <div id="ad-timer-progress" class="bg-purple-500 h-4 rounded-full" style="width: 100%"></div>
                        </div>
                    </div>
                    <button id="ad-complete-btn" class="w-full bg-gray-400 text-white font-semibold py-3 rounded-lg transition" disabled>
                        Please wait... (<span id="ad-timer">${duration}</span>s)
                    </button>
                </div>
            `);
            
            // Update timer every second
            state.adTimer = setInterval(() => {
                state.adTimerSeconds--;
                
                // Update UI
                document.getElementById('ad-timer').textContent = state.adTimerSeconds;
                document.getElementById('ad-timer-seconds').textContent = state.adTimerSeconds;
                
                // Update progress bar
                const progressPercent = (state.adTimerSeconds / duration) * 100;
                document.getElementById('ad-timer-progress').style.width = `${progressPercent}%`;
                
                // Check if timer is complete
                if (state.adTimerSeconds <= 0) {
                    clearInterval(state.adTimer);
                    state.adTimerActive = false;
                    
                    // Enable the complete button
                    const completeBtn = document.getElementById('ad-complete-btn');
                    completeBtn.disabled = false;
                    completeBtn.textContent = 'Complete & Earn Points';
                    completeBtn.className = 'w-full bg-purple-500 hover:bg-purple-600 text-white font-semibold py-3 rounded-lg transition';
                    completeBtn.onclick = () => completeAdView(points);
                }
            }, 1000);
        }

        function completeAdView(points = BASE_POINTS_REWARDS.ad) {
            if (!state.user) return;
            
            // Update missions
            updateMissions('adsWatched', 1);
            
            // Add points for watching ad
            addPoints('Watch Ad', points, true);
            
            hideModal();
            
            showModal(`
                <div class="text-center space-y-3">
                    <i class="fas fa-check-circle text-5xl text-green-500"></i>
                    <h3 class="text-xl font-bold text-green-600">Ad Completed!</h3>
                    <p class="text-gray-600">You earned ${points} EduPoints for watching the ad.</p>
                </div>
            `, () => {
                setTimeout(hideModal, 3000);
            });
        }

        function openMonetagAd(points = BASE_POINTS_REWARDS.ad, duration = 30) {
            if (!state.user) return;
            
            updateMonetagLink();
            if (state.currentMonetagLink) {
                // Start the timer
                startAdTimer(duration, points);
                
                // Open the monetag link in a new tab
                window.open(state.currentMonetagLink, '_blank');
            }
        }

        function watchQuickAd() {
            openMonetagAd(BASE_POINTS_REWARDS.quickAd, 15);
        }

        function watchPremiumAd() {
            openMonetagAd(BASE_POINTS_REWARDS.premiumAd, 60);
        }

        // =====================================================
        // FIREBASE DATA FUNCTIONS
        // =====================================================

        async function saveUser(userData) {
            if (!state.firebaseUser) return;
            
            try {
                const { doc, updateDoc } = window.firebaseModules;
                const db = window.firebaseDb;
                
                // Update in Firestore
                await updateDoc(doc(db, FIRESTORE_COLLECTIONS.USERS, state.firebaseUser.uid), {
                    ...userData,
                    updatedAt: Date.now()
                });
                
                // Also update local state
                state.user = { ...state.user, ...userData };
            } catch (error) {
                console.error("Error saving user:", error);
            }
        }

        async function addPoints(action, points, checkDailyLimit = true) {
            if (!state.user || !state.firebaseUser) return;
            
            // Check if user has reached daily limit (excluding referral bonuses)
            if (checkDailyLimit && hasReachedDailyLimit(state.user) && !action.includes('Referral') && !state.isPremium) {
                showModal(`
                    <div class="text-center space-y-3">
                        <i class="fas fa-exclamation-triangle text-5xl text-yellow-500"></i>
                        <h3 class="text-xl font-bold text-yellow-600">Daily Limit Reached</h3>
                        <p class="text-gray-600">You have reached your daily earning limit of ${formatPoints(DAILY_POINTS_LIMIT)} points. Come back tomorrow to earn more!</p>
                        <p class="text-sm text-blue-600">Note: Referral bonuses are not counted towards daily limits.</p>
                        ${!state.isPremium ? `
                            <button onclick="switchView('premium')" class="mt-4 bg-gradient-to-r from-purple-500 to-pink-500 text-white px-6 py-2 rounded-lg transition">
                                Go Premium to Remove Limits
                            </button>
                        ` : ''}
                    </div>
                `);
                return;
            }
            
            showLoading(true);

            try {
                const { doc, updateDoc } = window.firebaseModules;
                const db = window.firebaseDb;
                
                const newPoints = state.user.eduPoints + points;
                const historyEntry = { action, points, timestamp: Date.now() };
                const updatedHistory = [historyEntry, ...(state.user.history || [])];

                // Update in Firestore
                await updateDoc(doc(db, FIRESTORE_COLLECTIONS.USERS, state.firebaseUser.uid), {
                    eduPoints: newPoints,
                    history: updatedHistory,
                    missions: state.missions,
                    updatedAt: Date.now()
                });

                // Update local state
                state.user.eduPoints = newPoints;
                state.user.history = updatedHistory;

                await updateLeaderboards();
                checkAchievements();

                render();

                // Show points animation
                const coinAnimation = document.createElement('div');
                coinAnimation.className = 'fixed top-4 right-4 z-30';
                coinAnimation.innerHTML = `
                    <div class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded-lg shadow-lg slide-in">
                        <div class="flex items-center">
                            <i class="fas fa-coins text-xl mr-2"></i>
                            <span class="font-bold">+${points} EduPoints!</span>
                        </div>
                        <p class="text-sm mt-1">${action}</p>
                    </div>
                `;
                document.body.appendChild(coinAnimation);
                
                setTimeout(() => {
                    if (coinAnimation.parentNode) {
                        document.body.removeChild(coinAnimation);
                    }
                }, 3000);

            } catch (error) {
                console.error("Error adding points:", error);
                showModal(`
                    <div class="text-center space-y-3">
                        <i class="fas fa-exclamation-triangle text-5xl text-red-500"></i>
                        <h3 class="text-xl font-bold text-red-600">Error</h3>
                        <p class="text-gray-600">Failed to add points. Please try again.</p>
                    </div>
                `);
            } finally {
                showLoading(false);
            }
        }

        async function updateMissions(missionType, increment = 1) {
            if (!state.missions[missionType]) {
                state.missions[missionType] = 0;
            }
            state.missions[missionType] += increment;
            
            // Check mission completion
            checkMissionCompletion();
        }

        async function checkMissionCompletion() {
            const completedMissions = [];
            
            // Check ads mission
            if (state.missions.adsWatched >= 3 && !state.missions.adsCompleted) {
                completedMissions.push({
                    name: 'Watch 3 Ads',
                    points: 300
                });
                state.missions.adsCompleted = true;
            }
            
            // Check courses mission
            if (state.missions.coursesCompleted >= 2 && !state.missions.coursesCompletedFlag) {
                completedMissions.push({
                    name: 'Complete 2 Courses',
                    points: 500
                });
                state.missions.coursesCompletedFlag = true;
            }
            
            // Award points for completed missions
            for (const mission of completedMissions) {
                await addPoints(`Mission: ${mission.name}`, mission.points, false);
            }
            
            if (completedMissions.length > 0) {
                showModal(`
                    <div class="text-center space-y-3">
                        <i class="fas fa-trophy text-5xl text-yellow-500"></i>
                        <h3 class="text-xl font-bold text-yellow-600">Mission Completed!</h3>
                        <div class="space-y-2">
                            ${completedMissions.map(mission => `
                                <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-3">
                                    <p class="font-semibold">${mission.name}</p>
                                    <p class="text-sm text-green-600">+${formatPoints(mission.points)} points!</p>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `, () => {
                    setTimeout(hideModal, 3000);
                });
            }
        }

        async function loadCollection(collectionName) {
            try {
                const { collection, getDocs } = window.firebaseModules;
                const db = window.firebaseDb;
                
                const querySnapshot = await getDocs(collection(db, collectionName));
                const data = [];
                querySnapshot.forEach((doc) => {
                    data.push({ id: doc.id, ...doc.data() });
                });
                return data;
            } catch (error) {
                console.error(`Error loading collection ${collectionName}:`, error);
                return [];
            }
        }

        async function saveToCollection(collectionName, data) {
            try {
                const { collection, addDoc } = window.firebaseModules;
                const db = window.firebaseDb;
                
                const docRef = await addDoc(collection(db, collectionName), data);
                return docRef.id;
            } catch (error) {
                console.error(`Error saving to collection ${collectionName}:`, error);
                return null;
            }
        }

        // =====================================================
        // CORE APPLICATION LOGIC
        // =====================================================

        async function initMockData() {
            // Initialize lessons if empty
            const existingLessons = await loadCollection(FIRESTORE_COLLECTIONS.LESSONS);
            if (existingLessons.length === 0) {
                const lessons = getAllCourses();
                for (const lesson of lessons) {
                    await saveToCollection(FIRESTORE_COLLECTIONS.LESSONS, lesson);
                }
            }

            // Initialize quizzes if empty
            const existingQuizzes = await loadCollection(FIRESTORE_COLLECTIONS.QUIZZES);
            if (existingQuizzes.length === 0) {
                const quizzes = getAllQuizzes();
                for (const quiz of quizzes) {
                    await saveToCollection(FIRESTORE_COLLECTIONS.QUIZZES, quiz);
                }
            }

            // Initialize achievements if empty
            const existingAchievements = await loadCollection(FIRESTORE_COLLECTIONS.ACHIEVEMENTS);
            if (existingAchievements.length === 0) {
                const achievements = getAllAchievements();
                for (const achievement of achievements) {
                    await saveToCollection(FIRESTORE_COLLECTIONS.ACHIEVEMENTS, achievement);
                }
            }
        }

        function getAllCourses() {
            return [
                {
                    id: 'health-1',
                    title: 'Introduction to Complementary and Alternative Medicine',
                    category: 'Health & Medicine',
                    subcategory: 'Alternative Medicine',
                    content: `
                        <div class="course-content">
                            <div class="course-section">
                                <h3 class="text-xl font-bold mb-3">What is Complementary and Alternative Medicine?</h3>
                                <p class="mb-3">Complementary and Alternative Medicine (CAM) refers to medical products and practices that are not part of standard medical care.</p>
                            </div>
                        </div>
                    `,
                    duration: 10,
                    difficulty: 'Beginner',
                    points: 500,
                    order: 1
                },
                {
                    id: 'tech-1',
                    title: 'Introduction to Web Development',
                    category: 'Technology',
                    subcategory: 'Web Development',
                    content: `
                        <div class="course-content">
                            <div class="course-section">
                                <h3 class="text-xl font-bold mb-3">What is Web Development?</h3>
                                <p class="mb-3">Web development refers to the building, creating, and maintaining of websites.</p>
                            </div>
                        </div>
                    `,
                    duration: 15,
                    difficulty: 'Beginner',
                    points: 500,
                    order: 2
                }
            ];
        }

        function getAllQuizzes() {
            return [
                {
                    id: 'health-1-quiz',
                    title: 'Complementary and Alternative Medicine Quiz',
                    category: 'Health & Medicine',
                    courseId: 'health-1',
                    questions: [
                        { 
                            q: 'What is the main difference between complementary and alternative medicine?', 
                            options: [
                                'Complementary medicine is used together with standard care, while alternative medicine is used instead of standard care',
                                'Complementary medicine is more scientific than alternative medicine',
                                'Alternative medicine is always safer than complementary medicine',
                                'There is no significant difference between the two'
                            ], 
                            answer: 'Complementary medicine is used together with standard care, while alternative medicine is used instead of standard care' 
                        }
                    ]
                },
                {
                    id: 'tech-1-quiz',
                    title: 'Web Development Basics Quiz',
                    category: 'Technology',
                    courseId: 'tech-1',
                    questions: [
                        { 
                            q: 'Which language is primarily used for styling web pages?', 
                            options: [
                                'HTML',
                                'CSS',
                                'JavaScript',
                                'Python'
                            ], 
                            answer: 'CSS' 
                        }
                    ]
                }
            ];
        }

        function getAllAchievements() {
            return [
                { id: 'a1', name: 'First Steps', description: 'Complete your first lesson', icon: 'fas fa-footsteps', points: 1000, type: 'bronze', condition: { type: 'lessonsCompleted', threshold: 1 } },
                { id: 'a2', name: 'Quiz Whiz', description: 'Complete 5 quizzes', icon: 'fas fa-brain', points: 1000, type: 'silver', condition: { type: 'quizzesCompleted', threshold: 5 } },
                { id: 'a3', name: 'Learning Streak', description: 'Maintain a 7-day learning streak', icon: 'fas fa-fire', points: 1000, type: 'gold', condition: { type: 'streak', threshold: 7 } },
                { id: 'a4', name: 'Ad Enthusiast', description: 'Watch 50 ads', icon: 'fas fa-ad', points: 1500, type: 'silver', condition: { type: 'adsWatched', threshold: 50 } },
                { id: 'a5', name: 'Referral Master', description: 'Refer 10 friends', icon: 'fas fa-users', points: 2000, type: 'gold', condition: { type: 'referrals', threshold: 10 } }
            ];
        }

        async function initializeAppData() {
            // Load data from Firestore
            state.lessons = await loadCollection(FIRESTORE_COLLECTIONS.LESSONS);
            state.quizzes = await loadCollection(FIRESTORE_COLLECTIONS.QUIZZES);
            state.achievements = await loadCollection(FIRESTORE_COLLECTIONS.ACHIEVEMENTS);
            state.withdrawalRequests = await loadCollection(FIRESTORE_COLLECTIONS.WITHDRAWALS);

            // Initialize mock data if needed
            await initMockData();
            
            resetDailyCourses();
            await updateLeaderboards();
            checkAchievements();
            
            // Initialize monetag link
            updateMonetagLink();

            // Setup push notifications
            setupPushNotifications();
        }

        function resetDailyCourses() {
            if (!state.user) return;
            
            const today = new Date().toDateString();
            if (state.user.lastCourseReset !== today) {
                state.user.completedCoursesToday = {};
                state.user.lastCourseReset = today;
                saveUser({ completedCoursesToday: {}, lastCourseReset: today });
            }
        }

        async function updateLeaderboards() {
            try {
                const { collection, query, orderBy, limit, getDocs } = window.firebaseModules;
                const db = window.firebaseDb;
                
                // Get top 10 users by points
                const leaderboardQuery = query(
                    collection(db, FIRESTORE_COLLECTIONS.USERS),
                    orderBy('eduPoints', 'desc'),
                    limit(10)
                );
                
                const querySnapshot = await getDocs(leaderboardQuery);
                state.leaderboard = [];
                querySnapshot.forEach((doc) => {
                    state.leaderboard.push({ id: doc.id, ...doc.data() });
                });
            } catch (error) {
                console.error("Error updating leaderboard:", error);
            }
        }

        async function checkAchievements() {
            if (!state.user) return;
            
            const userAchievements = state.user.achievements || [];
            const unlockedAchievements = [];
            
            for (const achievement of state.achievements) {
                // Skip if already unlocked
                if (userAchievements.includes(achievement.id)) continue;
                
                let conditionMet = false;
                
                switch (achievement.condition.type) {
                    case 'lessonsCompleted':
                        conditionMet = Object.keys(state.user.completedCourses || {}).length >= achievement.condition.threshold;
                        break;
                    case 'quizzesCompleted':
                        conditionMet = Object.keys(state.user.completedQuizzes || {}).length >= achievement.condition.threshold;
                        break;
                    case 'streak':
                        conditionMet = (state.user.streak || 0) >= achievement.condition.threshold;
                        break;
                    case 'adsWatched':
                        conditionMet = (state.user.dailyAdCount || 0) >= achievement.condition.threshold;
                        break;
                    case 'referrals':
                        conditionMet = (state.user.referralCount || 0) >= achievement.condition.threshold;
                        break;
                }
                
                if (conditionMet) {
                    unlockedAchievements.push(achievement);
                    userAchievements.push(achievement.id);
                    
                    // Add achievement points
                    await addPoints(`Achievement: ${achievement.name}`, achievement.points, false);
                }
            }
            
            if (unlockedAchievements.length > 0) {
                // Update user achievements in Firestore
                await saveUser({ achievements: userAchievements });
                
                // Show achievement notification
                showModal(`
                    <div class="text-center space-y-3">
                        <i class="fas fa-trophy text-5xl text-yellow-500"></i>
                        <h3 class="text-xl font-bold text-yellow-600">Achievement Unlocked!</h3>
                        <div class="space-y-2">
                            ${unlockedAchievements.map(achievement => `
                                <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-3">
                                    <p class="font-semibold">${achievement.name}</p>
                                    <p class="text-sm text-yellow-700">${achievement.description}</p>
                                    <p class="text-sm text-green-600">+${formatPoints(achievement.points)} points!</p>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `, () => {
                    setTimeout(hideModal, 3000);
                });
            }
        }

        // =====================================================
        // RENDER FUNCTIONS
        // =====================================================

        function render() {
            const appContainer = document.getElementById('app');
            if (!appContainer) return;
            
            appContainer.innerHTML = '';
            showLoading(state.isLoading);

            // Show/hide mobile navigation based on auth state
            const mobileNav = document.getElementById('mobile-nav');
            const desktopSidebar = document.getElementById('desktop-sidebar');
            const socialBarAds = document.getElementById('social-bar-ads');
            
            if (state.user) {
                mobileNav.classList.remove('hidden');
                desktopSidebar.classList.remove('hidden');
                socialBarAds.classList.remove('hidden');
                // Adjust main content margin for sidebar
                const mainContent = document.querySelector('.main-content');
                if (mainContent) {
                    mainContent.style.marginLeft = '250px';
                }
            } else {
                mobileNav.classList.add('hidden');
                desktopSidebar.classList.add('hidden');
                socialBarAds.classList.add('hidden');
                const mainContent = document.querySelector('.main-content');
                if (mainContent) {
                    mainContent.style.marginLeft = '0';
                }
            }

            if (!state.user) {
                appContainer.innerHTML = renderAuthScreen();
                attachAuthListeners();
            } else if (state.currentView === 'loading') {
                appContainer.innerHTML = '<div class="flex flex-col items-center justify-center h-full p-8"><i class="fas fa-spinner fa-spin text-4xl text-blue-500"></i><p class="mt-4 text-gray-500">Loading Dashboard...</p></div>';
            } else {
                appContainer.innerHTML = renderHeader() + renderContent();
                updateMobileNav();
                updateSidebar();
                setupEventListeners();
            }
            
            updateBrowserTitle();
        }

        function renderAuthScreen() {
            const hasReferral = state.referralCode !== '';
            
            return `
                <div class="min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 to-indigo-100 p-4">
                    <div class="w-full max-w-md card p-8 space-y-6 shadow-xl">
                        <div class="text-center">
                            <h1 class="text-4xl font-extrabold text-blue-600 mb-2">EduHeTech</h1>
                            <p class="text-gray-600">Learn valuable skills and earn rewards!</p>
                            ${hasReferral ? `
                                <div class="mt-2 bg-green-50 border border-green-200 rounded-lg p-3">
                                    <p class="text-green-700 text-sm">
                                        <i class="fas fa-gift mr-1"></i>
                                        You've been referred! Get bonus points when you sign up.
                                    </p>
                                </div>
                            ` : ''}
                        </div>

                        <div id="auth-form-container" class="space-y-4">
                            <!-- Auth Form will be rendered here -->
                        </div>

                        <div class="text-center">
                            <button id="toggle-auth" class="text-sm text-blue-500 hover:text-blue-700 font-medium transition-colors">Need an account? Sign Up</button>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderLoginForm() {
            return `
                <h2 class="text-2xl font-bold text-center text-gray-800">Welcome Back</h2>
                <div class="space-y-4">
                    <div>
                        <label for="login-email" class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                        <input type="email" id="login-email" placeholder="Enter your email" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition">
                    </div>
                    <div>
                        <label for="login-password" class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                        <input type="password" id="login-password" placeholder="Enter your password" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition">
                    </div>
                    <button id="login-btn" class="w-full p-3 btn-primary font-semibold rounded-lg shadow-md hover:shadow-lg transition">Log In</button>
                </div>
                <div id="auth-error-message" class="text-red-500 text-sm text-center mt-2"></div>
            `;
        }

        function renderSignupForm() {
            return `
                <h2 class="text-2xl font-bold text-center text-gray-800">Join EduHeTech</h2>
                <div class="space-y-4">
                    <div>
                        <label for="signup-name" class="block text-sm font-medium text-gray-700 mb-1">Full Name</label>
                        <input type="text" id="signup-name" placeholder="Enter your full name" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition">
                    </div>
                    <div>
                        <label for="signup-email" class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                        <input type="email" id="signup-email" placeholder="Enter your email" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition">
                    </div>
                    <div>
                        <label for="signup-password" class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                        <input type="password" id="signup-password" placeholder="Create a password (min 6 chars)" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition">
                    </div>
                    ${state.referralCode ? `
                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-3">
                            <p class="text-blue-700 text-sm">
                                <i class="fas fa-gift mr-1"></i>
                                Referral code detected! You'll get bonus points when you sign up.
                            </p>
                            <input type="hidden" id="signup-referral" value="${state.referralCode}">
                        </div>
                    ` : `
                        <div>
                            <label for="signup-referral" class="block text-sm font-medium text-gray-700 mb-1">Referral Code (Optional)</label>
                            <input type="text" id="signup-referral" placeholder="Enter referral code if you have one" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition">
                        </div>
                    `}
                    <button id="signup-btn" class="w-full p-3 btn-primary font-semibold rounded-lg shadow-md hover:shadow-lg transition">Create Account</button>
                </div>
                <div id="auth-error-message" class="text-red-500 text-sm text-center mt-2"></div>
            `;
        }

        function attachAuthListeners() {
            const container = document.getElementById('auth-form-container');
            const toggleBtn = document.getElementById('toggle-auth');
            let isLogin = true;

            const updateForm = () => {
                container.innerHTML = isLogin ? renderLoginForm() : renderSignupForm();
                toggleBtn.textContent = isLogin ? 'Need an account? Sign Up' : 'Already have an account? Log In';
                attachFormListeners();
            };

            const attachFormListeners = () => {
                // Login form
                document.getElementById('login-btn')?.addEventListener('click', () => {
                    const email = document.getElementById('login-email').value;
                    const password = document.getElementById('login-password').value;
                    handleFirebaseLogin(email, password);
                });
                
                // Signup form
                document.getElementById('signup-btn')?.addEventListener('click', () => {
                    const name = document.getElementById('signup-name').value;
                    const email = document.getElementById('signup-email').value;
                    const password = document.getElementById('signup-password').value;
                    const referrerCode = document.getElementById('signup-referral')?.value || state.referralCode;
                    handleFirebaseSignup(name, email, password, referrerCode);
                });
                
                // Enter key support
                const attachEnterKey = (inputId, buttonId) => {
                    document.getElementById(inputId)?.addEventListener('keypress', (e) => {
                        if (e.key === 'Enter') document.getElementById(buttonId)?.click();
                    });
                };
                
                attachEnterKey('login-email', 'login-btn');
                attachEnterKey('login-password', 'login-btn');
                attachEnterKey('signup-name', 'signup-btn');
                attachEnterKey('signup-email', 'signup-btn');
                attachEnterKey('signup-password', 'signup-btn');
            };

            toggleBtn?.addEventListener('click', () => {
                isLogin = !isLogin;
                updateForm();
            });

            updateForm();
        }

        function handleAuthError(message) {
            const errorEl = document.getElementById('auth-error-message');
            if (errorEl) {
                errorEl.textContent = message;
                errorEl.classList.add('slide-in');
                setTimeout(() => errorEl.classList.remove('slide-in'), 500);
            }
        }

        function renderHeader() {
            if (!state.user) return '';
            
            return `
                <header class="bg-white shadow-sm border-b">
                    <div class="max-w-7xl mx-auto px-4 py-4">
                        <div class="flex justify-between items-center">
                            <div class="flex items-center">
                                <button class="md:hidden text-gray-600 mr-4" onclick="toggleMobileMenu()">
                                    <i class="fas fa-bars text-xl"></i>
                                </button>
                                <h1 class="text-xl font-bold text-blue-600">EduHeTech</h1>
                                ${state.isAdmin ? '<span class="ml-2 admin-badge px-2 py-1 rounded text-xs font-bold">ADMIN</span>' : ''}
                                ${state.isPremium ? '<span class="ml-2 bg-gradient-to-r from-yellow-400 to-orange-500 text-white px-2 py-1 rounded text-xs font-bold">PREMIUM</span>' : ''}
                            </div>
                            
                            <div class="flex items-center space-x-4">
                                <div class="flex items-center space-x-2 bg-blue-50 px-3 py-1 rounded-full">
                                    <i class="fas fa-coins text-yellow-500"></i>
                                    <span class="font-semibold">${formatPoints(state.user.eduPoints || 0)}</span>
                                </div>
                                <div class="hidden md:flex items-center space-x-2 bg-orange-50 px-3 py-1 rounded-full">
                                    <i class="fas fa-fire text-orange-500"></i>
                                    <span class="font-semibold">${state.user.streak || 0} days</span>
                                </div>
                                <button onclick="handleFirebaseLogout()" class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-sm transition hidden md:block">
                                    Logout
                                </button>
                            </div>
                        </div>
                    </div>
                </header>
            `;
        }

        function renderContent() {
            const views = {
                dashboard: renderDashboard(),
                learn: renderLearn(),
                quiz: renderQuiz(),
                ads: renderAds(),
                spin: renderSpinWheel(),
                videos: renderVideoSection(),
                missions: renderMissions(),
                blog: renderBlog(),
                premium: renderPremiumSection(),
                social: renderSocialSection(),
                referral: renderReferral(),
                rewards: renderRewards(),
                leaderboard: renderLeaderboard(),
                achievements: renderAchievements()
            };
            
            return `
                <div class="main-content min-h-screen bg-gray-50 pb-20 md:pb-0 transition-all duration-300">
                    <div class="max-w-7xl mx-auto px-4 py-6">
                        ${views[state.currentView] || '<div>View not found</div>'}
                    </div>
                </div>
            `;
        }

        // =====================================================
        // VIEW RENDER FUNCTIONS
        // =====================================================

        function renderDashboard() {
            const todayEarnings = getTodaysEarnings();
            const dailyLimitProgress = (todayEarnings / DAILY_POINTS_LIMIT) * 100;
            
            return `
                <div class="space-y-6 fade-in">
                    <!-- Welcome Section -->
                    <div class="card p-6">
                        <div class="flex flex-col md:flex-row justify-between items-start md:items-center">
                            <div>
                                <h2 class="text-2xl font-bold text-gray-800">Welcome back, ${state.user?.name || 'Learner'}!</h2>
                                <p class="text-gray-600">Continue your learning journey and earn rewards</p>
                            </div>
                            <div class="mt-4 md:mt-0 flex items-center space-x-4">
                                <div class="bg-blue-50 px-4 py-2 rounded-lg">
                                    <p class="text-sm text-blue-600">Today's Earnings</p>
                                    <p class="font-bold text-blue-800">${formatPoints(todayEarnings)} points</p>
                                </div>
                                <div class="bg-orange-50 px-4 py-2 rounded-lg">
                                    <p class="text-sm text-orange-600">Learning Streak</p>
                                    <p class="font-bold text-orange-800">${state.user?.streak || 0} days</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Daily Limit Counter -->
                    <div class="daily-limit-counter">
                        <div class="flex justify-between items-center mb-2">
                            <span class="font-semibold">Daily Earnings Progress</span>
                            <span class="text-sm">${formatPoints(todayEarnings)} / ${formatPoints(DAILY_POINTS_LIMIT)}</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill bg-yellow-400" style="width: ${Math.min(dailyLimitProgress, 100)}%"></div>
                        </div>
                        ${todayEarnings >= DAILY_POINTS_LIMIT ? `
                            <p class="text-sm mt-2 text-yellow-200">Daily limit reached. Come back tomorrow!</p>
                        ` : ''}
                    </div>

                    <!-- Stats Grid -->
                    <div class="stats-grid grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                        <div class="card p-6 text-center">
                            <i class="fas fa-coins text-4xl text-yellow-500 mb-3"></i>
                            <h3 class="text-lg font-semibold">Total Points</h3>
                            <p class="text-2xl font-bold text-gray-800">${formatPoints(state.user?.eduPoints || 0)}</p>
                        </div>
                        <div class="card p-6 text-center">
                            <i class="fas fa-book text-4xl text-blue-500 mb-3"></i>
                            <h3 class="text-lg font-semibold">Courses Completed</h3>
                            <p class="text-2xl font-bold text-gray-800">${Object.keys(state.user?.completedCourses || {}).length}</p>
                        </div>
                        <div class="card p-6 text-center">
                            <i class="fas fa-brain text-4xl text-green-500 mb-3"></i>
                            <h3 class="text-lg font-semibold">Quizzes Taken</h3>
                            <p class="text-2xl font-bold text-gray-800">${Object.keys(state.user?.completedQuizzes || {}).length}</p>
                        </div>
                        <div class="card p-6 text-center">
                            <i class="fas fa-users text-4xl text-purple-500 mb-3"></i>
                            <h3 class="text-lg font-semibold">Referrals</h3>
                            <p class="text-2xl font-bold text-gray-800">${state.user?.referralCount || 0}</p>
                        </div>
                    </div>

                    <!-- Quick Actions -->
                    <div class="card p-6">
                        <h3 class="text-xl font-bold mb-4">Quick Actions</h3>
                        <div class="quick-actions grid grid-cols-2 md:grid-cols-4 gap-4">
                            <button onclick="switchView('learn')" class="card p-4 text-center hover:shadow-lg transition cursor-pointer">
                                <i class="fas fa-book text-3xl text-blue-500 mb-2"></i>
                                <p class="font-semibold">Learn</p>
                                <p class="text-sm text-gray-600">Earn points</p>
                            </button>
                            <button onclick="switchView('quiz')" class="card p-4 text-center hover:shadow-lg transition cursor-pointer">
                                <i class="fas fa-brain text-3xl text-green-500 mb-2"></i>
                                <p class="font-semibold">Quiz</p>
                                <p class="text-sm text-gray-600">Test knowledge</p>
                            </button>
                            <button onclick="switchView('ads')" class="card p-4 text-center hover:shadow-lg transition cursor-pointer">
                                <i class="fas fa-ad text-3xl text-purple-500 mb-2"></i>
                                <p class="font-semibold">Watch Ads</p>
                                <p class="text-sm text-gray-600">Quick points</p>
                            </button>
                            <button onclick="switchView('spin')" class="card p-4 text-center hover:shadow-lg transition cursor-pointer">
                                <i class="fas fa-sync-alt text-3xl text-orange-500 mb-2"></i>
                                <p class="font-semibold">Spin Wheel</p>
                                <p class="text-sm text-gray-600">Daily bonus</p>
                            </button>
                        </div>
                    </div>

                    <!-- Recent Activity -->
                    <div class="card p-6">
                        <h3 class="text-xl font-bold mb-4">Recent Activity</h3>
                        <div class="space-y-3">
                            ${state.user?.history?.slice(0, 5).map(entry => `
                                <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                                    <div>
                                        <p class="font-medium">${entry.action}</p>
                                        <p class="text-sm text-gray-500">${new Date(entry.timestamp).toLocaleDateString()}</p>
                                    </div>
                                    <span class="text-green-600 font-semibold">+${formatPoints(entry.points)}</span>
                                </div>
                            `).join('') || '<p class="text-gray-500 text-center py-4">No recent activity</p>'}
                        </div>
                    </div>

                    <!-- Promotional Banner -->
                    <div class="promo-banner">
                        <div class="flex flex-col md:flex-row justify-between items-center">
                            <div>
                                <h3 class="font-bold text-lg">🚀 Go Premium!</h3>
                                <p class="text-sm">Unlock unlimited daily earnings and exclusive features</p>
                            </div>
                            <button onclick="switchView('premium')" class="mt-2 md:mt-0 bg-white text-orange-600 font-semibold px-4 py-2 rounded-lg hover:bg-gray-100 transition">
                                Upgrade Now
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderLearn() {
            const categories = [...new Set(state.lessons.map(lesson => lesson.category))];
            const completedCourses = Object.keys(state.user?.completedCourses || {});
            const completedToday = Object.keys(state.user?.completedCoursesToday || {});
            
            return `
                <div class="space-y-6 fade-in">
                    <div class="card p-6">
                        <h2 class="text-2xl font-bold text-gray-800 mb-2">Learn & Earn</h2>
                        <p class="text-gray-600">Complete courses to earn ${BASE_POINTS_REWARDS.lesson} points each</p>
                        
                        <!-- Daily Progress -->
                        <div class="mt-4 bg-blue-50 p-4 rounded-lg">
                            <div class="flex justify-between items-center mb-2">
                                <span class="font-semibold text-blue-800">Daily Course Progress</span>
                                <span class="text-sm text-blue-600">${completedToday.length} / 5 courses today</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill bg-blue-500" style="width: ${(completedToday.length / 5) * 100}%"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Category Filter -->
                    <div class="flex flex-wrap gap-2">
                        <button class="px-4 py-2 bg-blue-500 text-white rounded-lg transition" data-category="all">
                            All Categories
                        </button>
                        ${categories.map(category => `
                            <button class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition" data-category="${category}">
                                ${category}
                            </button>
                        `).join('')}
                    </div>

                    <!-- Courses Grid -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="courses-container">
                        ${state.lessons.map(lesson => {
                            const isCompleted = completedCourses.includes(lesson.id);
                            const completedToday = state.user?.completedCoursesToday?.[lesson.id];
                            const canTakeCourse = !completedToday;
                            
                            return `
                                <div class="card p-6 course-card ${isCompleted ? 'border-2 border-green-500' : ''}">
                                    <div class="flex justify-between items-start mb-4">
                                        <div>
                                            <h3 class="text-lg font-semibold">${lesson.title}</h3>
                                            <p class="text-sm text-gray-500">${lesson.category} • ${lesson.duration} mins</p>
                                        </div>
                                        ${isCompleted ? 
                                            '<span class="bg-green-100 text-green-800 text-xs px-2 py-1 rounded">Completed</span>' : 
                                            '<span class="bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded">Available</span>'
                                        }
                                    </div>
                                    
                                    <div class="mb-4">
                                        <p class="text-sm text-gray-600">Difficulty: ${lesson.difficulty}</p>
                                        <p class="text-sm text-green-600 font-semibold">Reward: ${formatPoints(lesson.points)} points</p>
                                    </div>
                                    
                                    <div class="space-y-3">
                                        <button 
                                            onclick="startCourse('${lesson.id}')" 
                                            class="w-full btn-primary py-2 ${!canTakeCourse ? 'opacity-50 cursor-not-allowed' : ''}"
                                            ${!canTakeCourse ? 'disabled' : ''}
                                        >
                                            ${canTakeCourse ? 'Start Learning' : 'Completed Today'}
                                        </button>
                                        
                                        ${lesson.courseId ? `
                                            <button 
                                                onclick="startQuiz('${lesson.courseId}')" 
                                                class="w-full bg-green-500 hover:bg-green-600 text-white py-2 rounded-lg transition"
                                            >
                                                Take Quiz
                                            </button>
                                        ` : ''}
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>

                    ${state.lessons.length === 0 ? `
                        <div class="card p-8 text-center">
                            <i class="fas fa-book-open text-5xl text-gray-300 mb-4"></i>
                            <h3 class="text-xl font-semibold text-gray-600">No Courses Available</h3>
                            <p class="text-gray-500 mt-2">Check back later for new learning materials</p>
                        </div>
                    ` : ''}
                </div>
            `;
        }

        function renderQuiz() {
            const availableQuizzes = state.quizzes.filter(quiz => 
                !state.user?.completedQuizzes?.[quiz.id]
            );
            const completedQuizzes = state.quizzes.filter(quiz => 
                state.user?.completedQuizzes?.[quiz.id]
            );
            
            return `
                <div class="space-y-6 fade-in">
                    <div class="card p-6">
                        <h2 class="text-2xl font-bold text-gray-800 mb-2">Test Your Knowledge</h2>
                        <p class="text-gray-600">Complete quizzes to earn ${BASE_POINTS_REWARDS.quiz} points each</p>
                    </div>

                    <!-- Available Quizzes -->
                    <div class="card p-6">
                        <h3 class="text-xl font-bold mb-4">Available Quizzes</h3>
                        ${availableQuizzes.length > 0 ? `
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                ${availableQuizzes.map(quiz => `
                                    <div class="border border-gray-200 rounded-lg p-4 hover:shadow-md transition">
                                        <h4 class="font-semibold text-lg mb-2">${quiz.title}</h4>
                                        <p class="text-sm text-gray-600 mb-3">${quiz.category} • ${quiz.questions?.length || 0} questions</p>
                                        <button 
                                            onclick="startQuiz('${quiz.id}')" 
                                            class="w-full btn-primary py-2"
                                        >
                                            Start Quiz
                                        </button>
                                    </div>
                                `).join('')}
                            </div>
                        ` : `
                            <div class="text-center py-8">
                                <i class="fas fa-check-circle text-5xl text-green-300 mb-4"></i>
                                <p class="text-gray-600">You've completed all available quizzes!</p>
                                <p class="text-sm text-gray-500 mt-2">New quizzes will be added regularly</p>
                            </div>
                        `}
                    </div>

                    <!-- Completed Quizzes -->
                    ${completedQuizzes.length > 0 ? `
                        <div class="card p-6">
                            <h3 class="text-xl font-bold mb-4">Completed Quizzes</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                ${completedQuizzes.map(quiz => `
                                    <div class="border border-green-200 bg-green-50 rounded-lg p-4">
                                        <h4 class="font-semibold text-lg mb-2">${quiz.title}</h4>
                                        <p class="text-sm text-gray-600 mb-2">Completed</p>
                                        <div class="flex justify-between items-center">
                                            <span class="text-green-600 font-semibold">+${BASE_POINTS_REWARDS.quiz} points</span>
                                            <button 
                                                onclick="reviewQuiz('${quiz.id}')" 
                                                class="text-blue-500 hover:text-blue-700 text-sm"
                                            >
                                                Review
                                            </button>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    ` : ''}
                </div>
            `;
        }

        function renderAds() {
            return `
                <div class="space-y-6 fade-in">
                    <div class="card p-6">
                        <h2 class="text-2xl font-bold text-gray-800 mb-2">Watch Ads & Earn</h2>
                        <p class="text-gray-600">Watch advertisements to earn points. Different ad types offer different rewards.</p>
                    </div>

                    <!-- Ad Options -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <!-- Quick Ad -->
                        <div class="card p-6 text-center">
                            <div class="w-20 h-20 bg-purple-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                <i class="fas fa-bolt text-3xl text-purple-500"></i>
                            </div>
                            <h3 class="text-xl font-semibold mb-2">Quick Ad</h3>
                            <p class="text-gray-600 mb-4">15 seconds • ${BASE_POINTS_REWARDS.quickAd} points</p>
                            <button onclick="watchQuickAd()" class="w-full btn-primary py-3">
                                Watch Quick Ad
                            </button>
                        </div>

                        <!-- Standard Ad -->
                        <div class="card p-6 text-center">
                            <div class="w-20 h-20 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                <i class="fas fa-ad text-3xl text-blue-500"></i>
                            </div>
                            <h3 class="text-xl font-semibold mb-2">Standard Ad</h3>
                            <p class="text-gray-600 mb-4">30 seconds • ${BASE_POINTS_REWARDS.ad} points</p>
                            <button onclick="openMonetagAd()" class="w-full btn-primary py-3">
                                Watch Standard Ad
                            </button>
                        </div>

                        <!-- Premium Ad -->
                        <div class="card p-6 text-center">
                            <div class="w-20 h-20 bg-yellow-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                <i class="fas fa-crown text-3xl text-yellow-500"></i>
                            </div>
                            <h3 class="text-xl font-semibold mb-2">Premium Ad</h3>
                            <p class="text-gray-600 mb-4">60 seconds • ${BASE_POINTS_REWARDS.premiumAd} points</p>
                            <button onclick="watchPremiumAd()" class="w-full btn-primary py-3">
                                Watch Premium Ad
                            </button>
                        </div>
                    </div>

                    <!-- Ad Stats -->
                    <div class="card p-6">
                        <h3 class="text-xl font-bold mb-4">Your Ad Statistics</h3>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                            <div class="text-center p-4 bg-purple-50 rounded-lg">
                                <p class="text-2xl font-bold text-purple-600">${state.missions?.adsWatched || 0}</p>
                                <p class="text-sm text-purple-700">Ads Watched</p>
                            </div>
                            <div class="text-center p-4 bg-blue-50 rounded-lg">
                                <p class="text-2xl font-bold text-blue-600">${(state.missions?.adsWatched || 0) * BASE_POINTS_REWARDS.ad}</p>
                                <p class="text-sm text-blue-700">Points Earned</p>
                            </div>
                            <div class="text-center p-4 bg-green-50 rounded-lg">
                                <p class="text-2xl font-bold text-green-600">3</p>
                                <p class="text-sm text-green-700">Daily Mission</p>
                            </div>
                            <div class="text-center p-4 bg-orange-50 rounded-lg">
                                <p class="text-2xl font-bold text-orange-600">${state.missions?.adsCompleted ? 'Completed' : 'In Progress'}</p>
                                <p class="text-sm text-orange-700">Mission Status</p>
                            </div>
                        </div>
                    </div>

                    <!-- Tips -->
                    <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                        <h4 class="font-semibold text-yellow-800 mb-2">💡 Tips for Better Earnings</h4>
                        <ul class="text-sm text-yellow-700 space-y-1">
                            <li>• Watch ads during breaks for consistent earnings</li>
                            <li>• Complete the daily mission for bonus points</li>
                            <li>• Premium users get higher ad rewards</li>
                            <li>• Avoid closing ads prematurely to receive points</li>
                        </ul>
                    </div>
                </div>
            `;
        }

        function renderSpinWheel() {
            const today = new Date().toDateString();
            const canSpin = state.lastSpinDate !== today;
            
            return `
                <div class="space-y-6 fade-in">
                    <div class="card p-6">
                        <h2 class="text-2xl font-bold text-gray-800 mb-2">Daily Spin Wheel</h2>
                        <p class="text-gray-600">Spin the wheel once daily for bonus points and rewards!</p>
                    </div>

                    <!-- Wheel Container -->
                    <div class="card p-8 text-center">
                        <div class="wheel-container">
                            <div class="wheel-pointer"></div>
                            <div id="wheel" class="wheel">
                                ${WHEEL_PRIZES.map((prize, index) => {
                                    const rotation = (360 / WHEEL_PRIZES.length) * index;
                                    return `
                                        <div class="wheel-item" style="transform: rotate(${rotation}deg)">
                                            <span style="transform: rotate(${-rotation}deg)">${prize.label}</span>
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                        </div>
                        
                        <button 
                            id="spin-btn" 
                            onclick="spinWheel()" 
                            class="mt-8 btn-primary px-8 py-3 text-lg font-semibold ${!canSpin ? 'opacity-50 cursor-not-allowed' : ''}"
                            ${!canSpin ? 'disabled' : ''}
                        >
                            ${canSpin ? 'SPIN NOW!' : 'Already Spun Today'}
                        </button>
                        
                        ${!canSpin ? `
                            <p class="text-gray-500 mt-2">Come back tomorrow for another spin!</p>
                        ` : ''}
                    </div>

                    <!-- Prize Information -->
                    <div class="card p-6">
                        <h3 class="text-xl font-bold mb-4">Possible Prizes</h3>
                        <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
                            ${WHEEL_PRIZES.map(prize => `
                                <div class="text-center p-4 border border-gray-200 rounded-lg">
                                    <p class="font-semibold text-lg">${prize.label}</p>
                                    <p class="text-sm text-gray-600">${prize.type === 'points' ? 'Instant Points' : 'Watch Ad to Claim'}</p>
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    <!-- Spin History -->
                    <div class="card p-6">
                        <h3 class="text-xl font-bold mb-4">Recent Spins</h3>
                        <div class="space-y-2">
                            ${state.user?.history?.filter(entry => entry.action.includes('Spin Wheel')).slice(0, 5).map(entry => `
                                <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                                    <div>
                                        <p class="font-medium">${entry.action}</p>
                                        <p class="text-sm text-gray-500">${new Date(entry.timestamp).toLocaleDateString()}</p>
                                    </div>
                                    <span class="text-green-600 font-semibold">+${formatPoints(entry.points)}</span>
                                </div>
                            `).join('') || '<p class="text-gray-500 text-center py-4">No spin history yet</p>'}
                        </div>
                    </div>
                </div>
            `;
        }

        function renderVideoSection() {
            return `
                <div class="space-y-6 fade-in">
                    <div class="card p-6">
                        <h2 class="text-2xl font-bold text-gray-800 mb-2">Watch & Earn</h2>
                        <p class="text-gray-600">Watch educational videos and earn ${BASE_POINTS_REWARDS.video} points per video</p>
                    </div>

                    <!-- Video Categories -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <!-- Educational Videos -->
                        <div class="card p-6">
                            <div class="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mb-4">
                                <i class="fas fa-play-circle text-2xl text-red-500"></i>
                            </div>
                            <h3 class="text-xl font-semibold mb-2">Educational Videos</h3>
                            <p class="text-gray-600 mb-4">Learn from curated educational content</p>
                            <button onclick="watchVideoAd('educational')" class="w-full btn-primary py-2">
                                Watch Videos
                            </button>
                        </div>

                        <!-- Tutorial Videos -->
                        <div class="card p-6">
                            <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mb-4">
                                <i class="fas fa-graduation-cap text-2xl text-blue-500"></i>
                            </div>
                            <h3 class="text-xl font-semibold mb-2">Tutorial Videos</h3>
                            <p class="text-gray-600 mb-4">Step-by-step skill tutorials</p>
                            <button onclick="watchVideoAd('tutorial')" class="w-full btn-primary py-2">
                                Watch Tutorials
                            </button>
                        </div>

                        <!-- Inspirational Videos -->
                        <div class="card p-6">
                            <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mb-4">
                                <i class="fas fa-lightbulb text-2xl text-green-500"></i>
                            </div>
                            <h3 class="text-xl font-semibold mb-2">Inspirational Videos</h3>
                            <p class="text-gray-600 mb-4">Motivational and success stories</p>
                            <button onclick="watchVideoAd('inspirational')" class="w-full btn-primary py-2">
                                Watch Stories
                            </button>
                        </div>
                    </div>

                    <!-- Video Stats -->
                    <div class="card p-6">
                        <h3 class="text-xl font-bold mb-4">Video Watching Progress</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <h4 class="font-semibold mb-2">Today's Progress</h4>
                                <div class="space-y-3">
                                    <div class="flex justify-between">
                                        <span>Videos Watched</span>
                                        <span class="font-semibold">${state.missions?.videosWatched || 0}/5</span>
                                    </div>
                                    <div class="progress-bar">
                                        <div class="progress-fill bg-green-500" style="width: ${((state.missions?.videosWatched || 0) / 5) * 100}%"></div>
                                    </div>
                                </div>
                            </div>
                            <div>
                                <h4 class="font-semibold mb-2">Total Earnings</h4>
                                <div class="text-center p-4 bg-green-50 rounded-lg">
                                    <p class="text-2xl font-bold text-green-600">${((state.missions?.videosWatched || 0) * BASE_POINTS_REWARDS.video).toLocaleString()}</p>
                                    <p class="text-sm text-green-700">Points from Videos</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderMissions() {
            const missions = [
                {
                    id: 'ads',
                    title: 'Watch 3 Ads',
                    description: 'Watch 3 advertisements of any type',
                    progress: state.missions?.adsWatched || 0,
                    target: 3,
                    reward: 300,
                    completed: state.missions?.adsCompleted || false,
                    icon: 'fas fa-ad',
                    color: 'purple'
                },
                {
                    id: 'courses',
                    title: 'Complete 2 Courses',
                    description: 'Finish 2 learning courses',
                    progress: state.missions?.coursesCompleted || 0,
                    target: 2,
                    reward: 500,
                    completed: state.missions?.coursesCompletedFlag || false,
                    icon: 'fas fa-book',
                    color: 'blue'
                },
                {
                    id: 'referrals',
                    title: 'Refer 1 Friend',
                    description: 'Successfully refer one friend to join',
                    progress: state.user?.referralCount || 0,
                    target: 1,
                    reward: 1000,
                    completed: (state.user?.referralCount || 0) >= 1,
                    icon: 'fas fa-users',
                    color: 'green'
                }
            ];

            const completedMissions = missions.filter(m => m.completed).length;
            const totalMissions = missions.length;

            return `
                <div class="space-y-6 fade-in">
                    <div class="card p-6">
                        <div class="flex flex-col md:flex-row justify-between items-start md:items-center">
                            <div>
                                <h2 class="text-2xl font-bold text-gray-800 mb-2">Daily Missions</h2>
                                <p class="text-gray-600">Complete missions to earn bonus points and rewards</p>
                            </div>
                            <div class="mt-4 md:mt-0 bg-blue-50 px-4 py-2 rounded-lg">
                                <p class="text-sm text-blue-600">Daily Progress</p>
                                <p class="font-bold text-blue-800">${completedMissions}/${totalMissions} Completed</p>
                            </div>
                        </div>
                    </div>

                    <!-- Missions Progress -->
                    <div class="card p-6">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-xl font-bold">Today's Missions</h3>
                            <span class="text-sm text-gray-500">Resets daily</span>
                        </div>
                        
                        <div class="space-y-4">
                            ${missions.map(mission => `
                                <div class="border border-gray-200 rounded-lg p-4 ${mission.completed ? 'bg-green-50 border-green-200' : ''}">
                                    <div class="flex items-start justify-between mb-3">
                                        <div class="flex items-center">
                                            <div class="w-10 h-10 bg-${mission.color}-100 rounded-full flex items-center justify-center mr-3">
                                                <i class="${mission.icon} text-${mission.color}-500"></i>
                                            </div>
                                            <div>
                                                <h4 class="font-semibold">${mission.title}</h4>
                                                <p class="text-sm text-gray-600">${mission.description}</p>
                                            </div>
                                        </div>
                                        ${mission.completed ? 
                                            '<span class="bg-green-100 text-green-800 text-xs px-2 py-1 rounded">Completed</span>' :
                                            '<span class="bg-gray-100 text-gray-800 text-xs px-2 py-1 rounded">In Progress</span>'
                                        }
                                    </div>
                                    
                                    <div class="space-y-2">
                                        <div class="flex justify-between text-sm">
                                            <span>Progress: ${mission.progress}/${mission.target}</span>
                                            <span class="font-semibold text-green-600">+${mission.reward} points</span>
                                        </div>
                                        <div class="progress-bar">
                                            <div class="progress-fill bg-${mission.color}-500" style="width: ${Math.min((mission.progress / mission.target) * 100, 100)}%"></div>
                                        </div>
                                    </div>
                                    
                                    ${!mission.completed && mission.id === 'referrals' ? `
                                        <button onclick="switchView('referral')" class="w-full mt-3 bg-${mission.color}-500 hover:bg-${mission.color}-600 text-white py-2 rounded-lg transition">
                                            Refer Friends
                                        </button>
                                    ` : ''}
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    <!-- Mission Rewards Info -->
                    <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                        <h4 class="font-semibold text-yellow-800 mb-2">🎯 Mission Completion Rewards</h4>
                        <ul class="text-sm text-yellow-700 space-y-1">
                            <li>• Complete all daily missions for a 500-point bonus</li>
                            <li>• Consistent mission completion increases your streak</li>
                            <li>• Premium users get double mission rewards</li>
                            <li>• Missions reset daily at midnight</li>
                        </ul>
                    </div>
                </div>
            `;
        }

        function renderBlog() {
            return `
                <div class="space-y-6 fade-in">
                    <div class="card p-6">
                        <h2 class="text-2xl font-bold text-gray-800 mb-2">EduHeTech Blog</h2>
                        <p class="text-gray-600">Learn tips, tricks, and success stories from our community</p>
                    </div>

                    <!-- Featured Article -->
                    <div class="card p-6 bg-gradient-to-r from-blue-500 to-purple-600 text-white">
                        <div class="flex flex-col md:flex-row items-center">
                            <div class="flex-1">
                                <span class="bg-white text-blue-600 text-xs px-3 py-1 rounded-full font-semibold mb-3 inline-block">FEATURED</span>
                                <h3 class="text-2xl font-bold mb-3">How to Maximize Your Earnings on EduHeTech</h3>
                                <p class="text-blue-100 mb-4">Learn proven strategies to increase your points earnings through smart learning and engagement.</p>
                                <button class="bg-white text-blue-600 font-semibold px-6 py-2 rounded-lg hover:bg-gray-100 transition">
                                    Read Article
                                </button>
                            </div>
                            <div class="mt-6 md:mt-0 md:ml-6">
                                <div class="w-48 h-32 bg-white bg-opacity-20 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-newspaper text-4xl text-white opacity-70"></i>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Blog Articles Grid -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <!-- Article 1 -->
                        <div class="card p-6 hover:shadow-lg transition cursor-pointer">
                            <div class="w-full h-40 bg-gray-200 rounded-lg mb-4 flex items-center justify-center">
                                <i class="fas fa-book text-3xl text-gray-400"></i>
                            </div>
                            <h3 class="text-lg font-semibold mb-2">The Science of Effective Learning</h3>
                            <p class="text-gray-600 text-sm mb-4">Discover research-backed techniques to learn faster and retain more information.</p>
                            <div class="flex justify-between items-center text-sm text-gray-500">
                                <span>5 min read</span>
                                <button class="text-blue-500 hover:text-blue-700 font-semibold">Read More →</button>
                            </div>
                        </div>

                        <!-- Article 2 -->
                        <div class="card p-6 hover:shadow-lg transition cursor-pointer">
                            <div class="w-full h-40 bg-gray-200 rounded-lg mb-4 flex items-center justify-center">
                                <i class="fas fa-coins text-3xl text-gray-400"></i>
                            </div>
                            <h3 class="text-lg font-semibold mb-2">Success Stories: How Users Earned ₦50,000+</h3>
                            <p class="text-gray-600 text-sm mb-4">Real stories from EduHeTech users who transformed their learning into significant earnings.</p>
                            <div class="flex justify-between items-center text-sm text-gray-500">
                                <span>7 min read</span>
                                <button class="text-blue-500 hover:text-blue-700 font-semibold">Read More →</button>
                            </div>
                        </div>

                        <!-- Article 3 -->
                        <div class="card p-6 hover:shadow-lg transition cursor-pointer">
                            <div class="w-full h-40 bg-gray-200 rounded-lg mb-4 flex items-center justify-center">
                                <i class="fas fa-mobile-alt text-3xl text-gray-400"></i>
                            </div>
                            <h3 class="text-lg font-semibold mb-2">Mobile Learning: Study Anytime, Anywhere</h3>
                            <p class="text-gray-600 text-sm mb-4">Maximize your learning potential by utilizing mobile-friendly study techniques.</p>
                            <div class="flex justify-between items-center text-sm text-gray-500">
                                <span>4 min read</span>
                                <button class="text-blue-500 hover:text-blue-700 font-semibold">Read More →</button>
                            </div>
                        </div>
                    </div>

                    <!-- Newsletter Signup -->
                    <div class="card p-6 bg-gray-800 text-white">
                        <div class="flex flex-col md:flex-row items-center justify-between">
                            <div class="mb-4 md:mb-0">
                                <h3 class="text-xl font-bold mb-2">Stay Updated</h3>
                                <p class="text-gray-300">Get the latest articles, tips, and platform updates delivered to your inbox.</p>
                            </div>
                            <div class="flex space-x-2">
                                <input type="email" placeholder="Your email address" class="px-4 py-2 rounded-lg text-gray-800 focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <button class="bg-blue-500 hover:bg-blue-600 px-6 py-2 rounded-lg font-semibold transition">
                                    Subscribe
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderPremiumSection() {
            const premiumFeatures = [
                {
                    icon: 'fas fa-infinity',
                    title: 'Unlimited Daily Earnings',
                    description: 'Remove the daily points limit and earn without restrictions'
                },
                {
                    icon: 'fas fa-rocket',
                    title: '2x Points Multiplier',
                    description: 'Earn double points on all activities including courses, quizzes, and ads'
                },
                {
                    icon: 'fas fa-ad',
                    title: 'Premium Ad Rewards',
                    description: 'Higher rewards for watching advertisements'
                },
                {
                    icon: 'fas fa-bolt',
                    title: 'Instant Withdrawals',
                    description: 'Priority processing for all withdrawal requests'
                },
                {
                    icon: 'fas fa-gem',
                    title: 'Exclusive Content',
                    description: 'Access to premium-only courses and learning materials'
                },
                {
                    icon: 'fas fa-headset',
                    title: 'Priority Support',
                    description: '24/7 dedicated customer support for premium members'
                }
            ];

            return `
                <div class="space-y-6 fade-in">
                    <div class="card p-6 bg-gradient-to-r from-purple-500 to-pink-600 text-white text-center">
                        <h2 class="text-3xl font-bold mb-4">Go Premium</h2>
                        <p class="text-xl opacity-90 mb-6">Unlock unlimited earning potential and exclusive features</p>
                        
                        <div class="max-w-md mx-auto bg-white bg-opacity-10 backdrop-blur-sm rounded-xl p-6">
                            <div class="text-4xl font-bold mb-2">₦2,500</div>
                            <div class="text-white opacity-80 mb-4">per month</div>
                            <button onclick="showPremiumModal()" class="w-full bg-white text-purple-600 font-bold py-4 rounded-lg hover:bg-gray-100 transition transform hover:scale-105">
                                Upgrade to Premium
                            </button>
                            <p class="text-sm opacity-80 mt-3">7-day free trial available</p>
                        </div>
                    </div>

                    <!-- Features Grid -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        ${premiumFeatures.map(feature => `
                            <div class="card p-6 text-center hover:shadow-lg transition">
                                <div class="w-16 h-16 bg-purple-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                    <i class="${feature.icon} text-2xl text-purple-500"></i>
                                </div>
                                <h3 class="text-lg font-semibold mb-2">${feature.title}</h3>
                                <p class="text-gray-600 text-sm">${feature.description}</p>
                            </div>
                        `).join('')}
                    </div>

                    <!-- Comparison Table -->
                    <div class="card p-6">
                        <h3 class="text-xl font-bold mb-6 text-center">Free vs Premium Comparison</h3>
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead>
                                    <tr class="border-b-2 border-gray-200">
                                        <th class="text-left py-3 px-4">Feature</th>
                                        <th class="text-center py-3 px-4 bg-blue-50">Free</th>
                                        <th class="text-center py-3 px-4 bg-purple-50 text-purple-600">Premium</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr class="border-b border-gray-100">
                                        <td class="py-3 px-4 font-medium">Daily Points Limit</td>
                                        <td class="py-3 px-4 text-center bg-blue-50">10,000</td>
                                        <td class="py-3 px-4 text-center bg-purple-50 font-semibold text-purple-600">Unlimited</td>
                                    </tr>
                                    <tr class="border-b border-gray-100">
                                        <td class="py-3 px-4 font-medium">Points Multiplier</td>
                                        <td class="py-3 px-4 text-center bg-blue-50">1x</td>
                                        <td class="py-3 px-4 text-center bg-purple-50 font-semibold text-purple-600">2x</td>
                                    </tr>
                                    <tr class="border-b border-gray-100">
                                        <td class="py-3 px-4 font-medium">Ad Rewards</td>
                                        <td class="py-3 px-4 text-center bg-blue-50">Standard</td>
                                        <td class="py-3 px-4 text-center bg-purple-50 font-semibold text-purple-600">Premium</td>
                                    </tr>
                                    <tr class="border-b border-gray-100">
                                        <td class="py-3 px-4 font-medium">Withdrawal Processing</td>
                                        <td class="py-3 px-4 text-center bg-blue-50">3-5 days</td>
                                        <td class="py-3 px-4 text-center bg-purple-50 font-semibold text-purple-600">Instant</td>
                                    </tr>
                                    <tr class="border-b border-gray-100">
                                        <td class="py-3 px-4 font-medium">Customer Support</td>
                                        <td class="py-3 px-4 text-center bg-blue-50">Standard</td>
                                        <td class="py-3 px-4 text-center bg-purple-50 font-semibold text-purple-600">Priority 24/7</td>
                                    </tr>
                                    <tr>
                                        <td class="py-3 px-4 font-medium">Exclusive Content</td>
                                        <td class="py-3 px-4 text-center bg-blue-50">❌ Not Available</td>
                                        <td class="py-3 px-4 text-center bg-purple-50 font-semibold text-purple-600">✅ Full Access</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Testimonials -->
                    <div class="card p-6">
                        <h3 class="text-xl font-bold mb-6 text-center">What Our Premium Users Say</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="bg-gray-50 p-6 rounded-lg">
                                <div class="flex items-center mb-4">
                                    <div class="w-12 h-12 bg-purple-100 rounded-full flex items-center justify-center mr-3">
                                        <i class="fas fa-user text-purple-500"></i>
                                    </div>
                                    <div>
                                        <p class="font-semibold">Chinedu O.</p>
                                        <p class="text-sm text-gray-500">Student</p>
                                    </div>
                                </div>
                                <p class="text-gray-600">"Since upgrading to Premium, I've been able to earn 3x more points. The unlimited daily earnings feature is a game-changer!"</p>
                            </div>
                            <div class="bg-gray-50 p-6 rounded-lg">
                                <div class="flex items-center mb-4">
                                    <div class="w-12 h-12 bg-purple-100 rounded-full flex items-center justify-center mr-3">
                                        <i class="fas fa-user text-purple-500"></i>
                                    </div>
                                    <div>
                                        <p class="font-semibold">Amina S.</p>
                                        <p class="text-sm text-gray-500">Freelancer</p>
                                    </div>
                                </div>
                                <p class="text-gray-600">"The 2x points multiplier helped me reach my first withdrawal goal in just 2 weeks. Worth every naira!"</p>
                            </div>
                        </div>
                    </div>

                    <!-- CTA Section -->
                    <div class="text-center">
                        <button onclick="showPremiumModal()" class="bg-gradient-to-r from-purple-500 to-pink-500 text-white px-8 py-4 rounded-lg font-bold text-lg hover:shadow-xl transition transform hover:scale-105">
                            Start Your Premium Journey Today
                        </button>
                        <p class="text-gray-500 mt-3">Join thousands of satisfied premium users</p>
                    </div>
                </div>
            `;
        }

        function renderSocialSection() {
            return `
                <div class="space-y-6 fade-in">
                    <div class="card p-6">
                        <h2 class="text-2xl font-bold text-gray-800 mb-2">Community</h2>
                        <p class="text-gray-600">Connect with other learners, share experiences, and grow together</p>
                    </div>

                    <!-- Community Stats -->
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                        <div class="card p-4 text-center">
                            <p class="text-2xl font-bold text-blue-600">10,000+</p>
                            <p class="text-sm text-gray-600">Active Learners</p>
                        </div>
                        <div class="card p-4 text-center">
                            <p class="text-2xl font-bold text-green-600">₦5M+</p>
                            <p class="text-sm text-gray-600">Total Earnings</p>
                        </div>
                        <div class="card p-4 text-center">
                            <p class="text-2xl font-bold text-purple-600">500+</p>
                            <p class="text-sm text-gray-600">Daily Discussions</p>
                        </div>
                        <div class="card p-4 text-center">
                            <p class="text-2xl font-bold text-orange-600">4.8/5</p>
                            <p class="text-sm text-gray-600">Community Rating</p>
                        </div>
                    </div>

                    <!-- Discussion Feed -->
                    <div class="card p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-xl font-bold">Recent Discussions</h3>
                            <button class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition">
                                Start Discussion
                            </button>
                        </div>

                        <div class="space-y-4">
                            <!-- Discussion 1 -->
                            <div class="border border-gray-200 rounded-lg p-4 hover:shadow-md transition cursor-pointer">
                                <div class="flex items-start justify-between mb-3">
                                    <div class="flex items-center">
                                        <div class="w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center mr-3">
                                            <i class="fas fa-user text-blue-500"></i>
                                        </div>
                                        <div>
                                            <p class="font-semibold">David T.</p>
                                            <p class="text-sm text-gray-500">2 hours ago</p>
                                        </div>
                                    </div>
                                    <span class="bg-green-100 text-green-800 text-xs px-2 py-1 rounded">Learning</span>
                                </div>
                                <h4 class="font-semibold text-lg mb-2">Best strategies for completing courses faster?</h4>
                                <p class="text-gray-600 mb-3">I've been trying to optimize my learning time. Any tips on how to complete courses more efficiently while still retaining the information?</p>
                                <div class="flex items-center text-sm text-gray-500">
                                    <span class="flex items-center mr-4">
                                        <i class="fas fa-comment mr-1"></i>
                                        12 comments
                                    </span>
                                    <span class="flex items-center">
                                        <i class="fas fa-heart mr-1"></i>
                                        24 likes
                                    </span>
                                </div>
                            </div>

                            <!-- Discussion 2 -->
                            <div class="border border-gray-200 rounded-lg p-4 hover:shadow-md transition cursor-pointer">
                                <div class="flex items-start justify-between mb-3">
                                    <div class="flex items-center">
                                        <div class="w-10 h-10 bg-green-100 rounded-full flex items-center justify-center mr-3">
                                            <i class="fas fa-user text-green-500"></i>
                                        </div>
                                        <div>
                                            <p class="font-semibold">Sarah K.</p>
                                            <p class="text-sm text-gray-500">5 hours ago</p>
                                        </div>
                                    </div>
                                    <span class="bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded">Success</span>
                                </div>
                                <h4 class="font-semibold text-lg mb-2">Just reached 100,000 points! 🎉</h4>
                                <p class="text-gray-600 mb-3">After 3 weeks of consistent learning, I've finally reached 100k points! This platform has been amazing for both learning and earning.</p>
                                <div class="flex items-center text-sm text-gray-500">
                                    <span class="flex items-center mr-4">
                                        <i class="fas fa-comment mr-1"></i>
                                        8 comments
                                    </span>
                                    <span class="flex items-center">
                                        <i class="fas fa-heart mr-1"></i>
                                        45 likes
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Study Groups -->
                    <div class="card p-6">
                        <h3 class="text-xl font-bold mb-4">Study Groups</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                            <div class="border border-gray-200 rounded-lg p-4 text-center hover:shadow-md transition cursor-pointer">
                                <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-3">
                                    <i class="fas fa-code text-blue-500 text-xl"></i>
                                </div>
                                <h4 class="font-semibold mb-2">Web Development</h4>
                                <p class="text-sm text-gray-600 mb-3">245 members</p>
                                <button class="w-full bg-blue-500 hover:bg-blue-600 text-white py-2 rounded-lg transition">
                                    Join Group
                                </button>
                            </div>

                            <div class="border border-gray-200 rounded-lg p-4 text-center hover:shadow-md transition cursor-pointer">
                                <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-3">
                                    <i class="fas fa-heartbeat text-green-500 text-xl"></i>
                                </div>
                                <h4 class="font-semibold mb-2">Health & Medicine</h4>
                                <p class="text-sm text-gray-600 mb-3">189 members</p>
                                <button class="w-full bg-green-500 hover:bg-green-600 text-white py-2 rounded-lg transition">
                                    Join Group
                                </button>
                            </div>

                            <div class="border border-gray-200 rounded-lg p-4 text-center hover:shadow-md transition cursor-pointer">
                                <div class="w-16 h-16 bg-purple-100 rounded-full flex items-center justify-center mx-auto mb-3">
                                    <i class="fas fa-chart-line text-purple-500 text-xl"></i>
                                </div>
                                <h4 class="font-semibold mb-2">Business & Finance</h4>
                                <p class="text-sm text-gray-600 mb-3">312 members</p>
                                <button class="w-full bg-purple-500 hover:bg-purple-600 text-white py-2 rounded-lg transition">
                                    Join Group
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderReferral() {
            const referralLink = `${window.location.origin}${window.location.pathname}?ref=${state.user?.referralCode}`;
            
            return `
                <div class="space-y-6 fade-in">
                    <div class="card p-6 bg-gradient-to-r from-green-500 to-blue-500 text-white">
                        <h2 class="text-2xl font-bold mb-2">Refer & Earn</h2>
                        <p class="opacity-90">Invite friends and earn ${BASE_POINTS_REWARDS.referral} points for each successful referral!</p>
                    </div>

                    <!-- Referral Stats -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="card p-6 text-center">
                            <i class="fas fa-users text-4xl text-blue-500 mb-3"></i>
                            <p class="text-2xl font-bold text-gray-800">${state.user?.referralCount || 0}</p>
                            <p class="text-gray-600">Friends Referred</p>
                        </div>
                        <div class="card p-6 text-center">
                            <i class="fas fa-coins text-4xl text-yellow-500 mb-3"></i>
                            <p class="text-2xl font-bold text-gray-800">${((state.user?.referralCount || 0) * BASE_POINTS_REWARDS.referral).toLocaleString()}</p>
                            <p class="text-gray-600">Points Earned</p>
                        </div>
                        <div class="card p-6 text-center">
                            <i class="fas fa-trophy text-4xl text-purple-500 mb-3"></i>
                            <p class="text-2xl font-bold text-gray-800">${state.user?.referralCount || 0}/10</p>
                            <p class="text-gray-600">Referral Master Progress</p>
                        </div>
                    </div>

                    <!-- Referral Link -->
                    <div class="card p-6">
                        <h3 class="text-xl font-bold mb-4">Your Referral Link</h3>
                        <div class="flex flex-col md:flex-row gap-3">
                            <div class="flex-1 bg-gray-100 p-3 rounded-lg border border-gray-200 overflow-x-auto">
                                <code class="text-sm text-gray-800">${referralLink}</code>
                            </div>
                            <button onclick="copyReferralLink()" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-lg transition flex items-center justify-center">
                                <i class="fas fa-copy mr-2"></i>
                                Copy Link
                            </button>
                        </div>
                        <p class="text-sm text-gray-500 mt-2">Share this link with your friends. When they sign up using your link, you both get bonus points!</p>
                    </div>

                    <!-- Share Options -->
                    <div class="card p-6">
                        <h3 class="text-xl font-bold mb-4">Share Via</h3>
                        <div class="share-buttons">
                            <button onclick="shareOnWhatsApp()" class="share-btn share-whatsapp">
                                <i class="fab fa-whatsapp mr-2"></i>
                                WhatsApp
                            </button>
                            <button onclick="shareOnFacebook()" class="share-btn share-facebook">
                                <i class="fab fa-facebook mr-2"></i>
                                Facebook
                            </button>
                            <button onclick="shareOnTwitter()" class="share-btn share-twitter">
                                <i class="fab fa-twitter mr-2"></i>
                                Twitter
                            </button>
                        </div>
                    </div>

                    <!-- How It Works -->
                    <div class="card p-6">
                        <h3 class="text-xl font-bold mb-4">How Referral Works</h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <div class="text-center">
                                <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-3">
                                    <span class="text-blue-600 font-bold text-xl">1</span>
                                </div>
                                <h4 class="font-semibold mb-2">Share Your Link</h4>
                                <p class="text-sm text-gray-600">Share your unique referral link with friends and family</p>
                            </div>
                            <div class="text-center">
                                <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-3">
                                    <span class="text-green-600 font-bold text-xl">2</span>
                                </div>
                                <h4 class="font-semibold mb-2">They Sign Up</h4>
                                <p class="text-sm text-gray-600">Your friends sign up using your referral link</p>
                            </div>
                            <div class="text-center">
                                <div class="w-16 h-16 bg-purple-100 rounded-full flex items-center justify-center mx-auto mb-3">
                                    <span class="text-purple-600 font-bold text-xl">3</span>
                                </div>
                                <h4 class="font-semibold mb-2">You Both Earn</h4>
                                <p class="text-sm text-gray-600">You get ${BASE_POINTS_REWARDS.referral} points, they get 500 bonus points</p>
                            </div>
                        </div>
                    </div>

                    <!-- Referral Tips -->
                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                        <h4 class="font-semibold text-blue-800 mb-2">💡 Pro Referral Tips</h4>
                        <ul class="text-sm text-blue-700 space-y-1">
                            <li>• Share on social media platforms for maximum reach</li>
                            <li>• Explain the benefits of EduHeTech to your friends</li>
                            <li>• Join our affiliate program for even higher rewards</li>
                            <li>• Track your referrals in the leaderboard section</li>
                        </ul>
                    </div>
                </div>
            `;
        }

        function renderRewards() {
            const canWithdraw = (state.user?.eduPoints || 0) >= MIN_WITHDRAWAL_POINTS;
            const pointsValue = ((state.user?.eduPoints || 0) / ADMIN_CONFIG.POINTS_TO_CURRENCY_RATE).toFixed(2);
            
            return `
                <div class="space-y-6 fade-in">
                    <div class="card p-6">
                        <h2 class="text-2xl font-bold text-gray-800 mb-2">Wallet & Withdrawals</h2>
                        <p class="text-gray-600">Convert your EduPoints to real money and withdraw to your bank account</p>
                    </div>

                    <!-- Balance Overview -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="card p-6 bg-gradient-to-r from-yellow-400 to-orange-500 text-white">
                            <h3 class="text-lg font-semibold mb-2">Your EduPoints Balance</h3>
                            <p class="text-3xl font-bold">${formatPoints(state.user?.eduPoints || 0)}</p>
                            <p class="text-yellow-100 mt-2">≈ ₦${pointsValue}</p>
                        </div>
                        <div class="card p-6">
                            <h3 class="text-lg font-semibold mb-4">Withdrawal Information</h3>
                            <div class="space-y-3">
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Minimum Withdrawal</span>
                                    <span class="font-semibold">${formatPoints(MIN_WITHDRAWAL_POINTS)} points</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Conversion Rate</span>
                                    <span class="font-semibold">${(ADMIN_CONFIG.POINTS_TO_CURRENCY_RATE).toLocaleString()} pts = ₦1</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Processing Time</span>
                                    <span class="font-semibold">${state.isPremium ? 'Instant' : '3-5 business days'}</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Withdrawal Form -->
                    <div class="card p-6">
                        <h3 class="text-xl font-bold mb-4">Request Withdrawal</h3>
                        
                        ${canWithdraw ? `
                            <form id="withdrawal-form" class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Bank Name</label>
                                    <input type="text" id="bank-name" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition">
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Account Number</label>
                                    <input type="text" id="account-number" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition">
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Account Name</label>
                                    <input type="text" id="account-name" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition">
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Amount to Withdraw (Points)</label>
                                    <input type="number" id="withdrawal-amount" min="${MIN_WITHDRAWAL_POINTS}" max="${state.user?.eduPoints || 0}" required 
                                           class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition"
                                           value="${Math.max(MIN_WITHDRAWAL_POINTS, state.user?.eduPoints || 0)}">
                                    <p class="text-sm text-gray-500 mt-1">
                                        Available: ${formatPoints(state.user?.eduPoints || 0)} points • 
                                        Equivalent: ₦${((state.user?.eduPoints || 0) / ADMIN_CONFIG.POINTS_TO_CURRENCY_RATE).toFixed(2)}
                                    </p>
                                </div>
                                
                                <button type="submit" class="w-full bg-green-500 hover:bg-green-600 text-white font-semibold py-3 rounded-lg transition">
                                    Request Withdrawal
                                </button>
                            </form>
                        ` : `
                            <div class="text-center py-8">
                                <i class="fas fa-piggy-bank text-5xl text-gray-300 mb-4"></i>
                                <h4 class="text-lg font-semibold text-gray-600 mb-2">Not Enough Points</h4>
                                <p class="text-gray-500 mb-4">You need at least ${formatPoints(MIN_WITHDRAWAL_POINTS)} points to make a withdrawal.</p>
                                <p class="text-sm text-gray-500">Current balance: ${formatPoints(state.user?.eduPoints || 0)} points</p>
                                <button onclick="switchView('learn')" class="mt-4 bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-lg transition">
                                    Earn More Points
                                </button>
                            </div>
                        `}
                    </div>

                    <!-- Withdrawal History -->
                    <div class="card p-6">
                        <h3 class="text-xl font-bold mb-4">Withdrawal History</h3>
                        <div class="space-y-3">
                            ${state.withdrawalRequests?.filter(req => req.userId === state.user?.uid).map(request => `
                                <div class="flex justify-between items-center p-3 border border-gray-200 rounded-lg">
                                    <div>
                                        <p class="font-medium">${formatPoints(request.amount)} points</p>
                                        <p class="text-sm text-gray-500">${new Date(request.timestamp).toLocaleDateString()}</p>
                                    </div>
                                    <span class="px-3 py-1 rounded-full text-xs font-semibold ${
                                        request.status === 'completed' ? 'bg-green-100 text-green-800' :
                                        request.status === 'pending' ? 'bg-yellow-100 text-yellow-800' :
                                        'bg-red-100 text-red-800'
                                    }">
                                        ${request.status.charAt(0).toUpperCase() + request.status.slice(1)}
                                    </span>
                                </div>
                            `).join('') || '<p class="text-gray-500 text-center py-4">No withdrawal history yet</p>'}
                        </div>
                    </div>

                    <!-- Withdrawal Tips -->
                    <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                        <h4 class="font-semibold text-green-800 mb-2">💡 Withdrawal Tips</h4>
                        <ul class="text-sm text-green-700 space-y-1">
                            <li>• Ensure your bank details are correct before submitting</li>
                            <li>• Withdrawal processing times may vary by bank</li>
                            <li>• Premium users enjoy instant withdrawal processing</li>
                            <li>• Contact support if you don't receive your funds within 5 days</li>
                        </ul>
                    </div>
                </div>
            `;
        }

        function renderLeaderboard() {
            return `
                <div class="space-y-6 fade-in">
                    <div class="card p-6">
                        <h2 class="text-2xl font-bold text-gray-800 mb-2">Leaderboard</h2>
                        <p class="text-gray-600">See how you rank among other EduHeTech learners</p>
                    </div>

                    <!-- Time Filters -->
                    <div class="flex space-x-2 overflow-x-auto pb-2">
                        <button class="px-4 py-2 bg-blue-500 text-white rounded-lg transition">All Time</button>
                        <button class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition">This Month</button>
                        <button class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition">This Week</button>
                        <button class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition">Today</button>
                    </div>

                    <!-- User's Rank -->
                    ${state.leaderboard?.find(user => user.uid === state.user?.uid) ? `
                        <div class="card p-6 bg-blue-50 border border-blue-200">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center">
                                    <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center mr-4">
                                        <i class="fas fa-user text-blue-500"></i>
                                    </div>
                                    <div>
                                        <p class="font-semibold">Your Rank</p>
                                        <p class="text-2xl font-bold text-blue-600">
                                            #${state.leaderboard.findIndex(user => user.uid === state.user?.uid) + 1}
                                        </p>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <p class="text-sm text-gray-600">Your Points</p>
                                    <p class="text-xl font-bold text-gray-800">${formatPoints(state.user?.eduPoints || 0)}</p>
                                </div>
                            </div>
                        </div>
                    ` : ''}

                    <!-- Leaderboard List -->
                    <div class="card p-6">
                        <h3 class="text-xl font-bold mb-4">Top Learners</h3>
                        <div class="space-y-3">
                            ${state.leaderboard?.map((user, index) => `
                                <div class="flex items-center justify-between p-3 border border-gray-200 rounded-lg ${
                                    user.uid === state.user?.uid ? 'bg-blue-50 border-blue-200' : ''
                                }">
                                    <div class="flex items-center">
                                        <div class="w-8 h-8 flex items-center justify-center mr-3 ${
                                            index === 0 ? 'bg-yellow-100 text-yellow-600' :
                                            index === 1 ? 'bg-gray-100 text-gray-600' :
                                            index === 2 ? 'bg-orange-100 text-orange-600' :
                                            'bg-blue-100 text-blue-600'
                                        } rounded-full font-semibold">
                                            ${index + 1}
                                        </div>
                                        <div>
                                            <p class="font-semibold">${user.name}</p>
                                            <p class="text-sm text-gray-500">${user.referralCount || 0} referrals • ${user.streak || 0} day streak</p>
                                        </div>
                                    </div>
                                    <div class="text-right">
                                        <p class="font-bold text-gray-800">${formatPoints(user.eduPoints || 0)}</p>
                                        <p class="text-sm text-gray-500">points</p>
                                    </div>
                                </div>
                            `).join('') || '<p class="text-gray-500 text-center py-4">No leaderboard data available</p>'}
                        </div>
                    </div>

                    <!-- Leaderboard Categories -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="card p-6">
                            <h3 class="text-xl font-bold mb-4">Top Referrers</h3>
                            <div class="space-y-3">
                                ${state.leaderboard?.sort((a, b) => (b.referralCount || 0) - (a.referralCount || 0)).slice(0, 5).map((user, index) => `
                                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                        <div class="flex items-center">
                                            <div class="w-8 h-8 flex items-center justify-center mr-3 bg-green-100 text-green-600 rounded-full font-semibold">
                                                ${index + 1}
                                            </div>
                                            <p class="font-semibold">${user.name}</p>
                                        </div>
                                        <span class="bg-green-100 text-green-800 text-xs px-2 py-1 rounded font-semibold">
                                            ${user.referralCount || 0} referrals
                                        </span>
                                    </div>
                                `).join('')}
                            </div>
                        </div>

                        <div class="card p-6">
                            <h3 class="text-xl font-bold mb-4">Learning Streaks</h3>
                            <div class="space-y-3">
                                ${state.leaderboard?.sort((a, b) => (b.streak || 0) - (a.streak || 0)).slice(0, 5).map((user, index) => `
                                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                        <div class="flex items-center">
                                            <div class="w-8 h-8 flex items-center justify-center mr-3 bg-orange-100 text-orange-600 rounded-full font-semibold">
                                                ${index + 1}
                                            </div>
                                            <p class="font-semibold">${user.name}</p>
                                        </div>
                                        <span class="bg-orange-100 text-orange-800 text-xs px-2 py-1 rounded font-semibold">
                                            ${user.streak || 0} days
                                        </span>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderAchievements() {
            const userAchievements = state.user?.achievements || [];
            
            return `
                <div class="space-y-6 fade-in">
                    <div class="card p-6">
                        <h2 class="text-2xl font-bold text-gray-800 mb-2">Achievements</h2>
                        <p class="text-gray-600">Unlock achievements to earn bonus points and showcase your progress</p>
                    </div>

                    <!-- Achievement Progress -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="card p-6 text-center">
                            <i class="fas fa-trophy text-4xl text-yellow-500 mb-3"></i>
                            <p class="text-2xl font-bold text-gray-800">${userAchievements.length}</p>
                            <p class="text-gray-600">Achievements Unlocked</p>
                        </div>
                        <div class="card p-6 text-center">
                            <i class="fas fa-medal text-4xl text-blue-500 mb-3"></i>
                            <p class="text-2xl font-bold text-gray-800">${state.achievements?.length || 0}</p>
                            <p class="text-gray-600">Total Achievements</p>
                        </div>
                        <div class="card p-6 text-center">
                            <i class="fas fa-coins text-4xl text-green-500 mb-3"></i>
                            <p class="text-2xl font-bold text-gray-800">${(userAchievements.length * 1000).toLocaleString()}</p>
                            <p class="text-gray-600">Points from Achievements</p>
                        </div>
                    </div>

                    <!-- Achievements Grid -->
                    <div class="achievement-grid">
                        ${state.achievements?.map(achievement => {
                            const isUnlocked = userAchievements.includes(achievement.id);
                            let progress = 0;
                            let current = 0;
                            
                            switch (achievement.condition.type) {
                                case 'lessonsCompleted':
                                    current = Object.keys(state.user?.completedCourses || {}).length;
                                    progress = Math.min((current / achievement.condition.threshold) * 100, 100);
                                    break;
                                case 'quizzesCompleted':
                                    current = Object.keys(state.user?.completedQuizzes || {}).length;
                                    progress = Math.min((current / achievement.condition.threshold) * 100, 100);
                                    break;
                                case 'streak':
                                    current = state.user?.streak || 0;
                                    progress = Math.min((current / achievement.condition.threshold) * 100, 100);
                                    break;
                                case 'adsWatched':
                                    current = state.missions?.adsWatched || 0;
                                    progress = Math.min((current / achievement.condition.threshold) * 100, 100);
                                    break;
                                case 'referrals':
                                    current = state.user?.referralCount || 0;
                                    progress = Math.min((current / achievement.condition.threshold) * 100, 100);
                                    break;
                            }
                            
                            return `
                                <div class="achievement-card border-2 ${
                                    isUnlocked ? 
                                    'border-yellow-400 bg-yellow-50' : 
                                    'border-gray-200 bg-white'
                                }">
                                    <div class="w-16 h-16 mx-auto mb-3 relative">
                                        <i class="${achievement.icon} text-3xl ${
                                            isUnlocked ? 
                                            'text-yellow-500' : 
                                            'text-gray-300'
                                        }"></i>
                                        ${isUnlocked ? `
                                            <div class="absolute -top-1 -right-1 w-6 h-6 bg-green-500 rounded-full flex items-center justify-center">
                                                <i class="fas fa-check text-white text-xs"></i>
                                            </div>
                                        ` : ''}
                                    </div>
                                    
                                    <h4 class="font-semibold mb-1">${achievement.name}</h4>
                                    <p class="text-sm text-gray-600 mb-3">${achievement.description}</p>
                                    
                                    ${!isUnlocked ? `
                                        <div class="space-y-2">
                                            <div class="progress-bar">
                                                <div class="progress-fill bg-${achievement.type === 'bronze' ? 'yellow' : achievement.type === 'silver' ? 'gray' : 'yellow'}-500" 
                                                     style="width: ${progress}%"></div>
                                            </div>
                                            <p class="text-xs text-gray-500 text-center">${current}/${achievement.condition.threshold}</p>
                                        </div>
                                    ` : ''}
                                    
                                    <div class="flex justify-between items-center mt-3">
                                        <span class="text-sm font-semibold text-green-600">+${formatPoints(achievement.points)}</span>
                                        <span class="text-xs px-2 py-1 rounded ${
                                            achievement.type === 'bronze' ? 'bg-yellow-100 text-yellow-800' :
                                            achievement.type === 'silver' ? 'bg-gray-100 text-gray-800' :
                                            'bg-yellow-100 text-yellow-800'
                                        }">
                                            ${achievement.type.toUpperCase()}
                                        </span>
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>

                    ${state.achievements?.length === 0 ? `
                        <div class="card p-8 text-center">
                            <i class="fas fa-trophy text-5xl text-gray-300 mb-4"></i>
                            <h3 class="text-xl font-semibold text-gray-600">No Achievements Available</h3>
                            <p class="text-gray-500 mt-2">Achievements will be available as you start using the platform</p>
                        </div>
                    ` : ''}

                    <!-- Achievement Tips -->
                    <div class="bg-purple-50 border border-purple-200 rounded-lg p-4">
                        <h4 class="font-semibold text-purple-800 mb-2">🎯 Achievement Hunting Tips</h4>
                        <ul class="text-sm text-purple-700 space-y-1">
                            <li>• Complete courses daily to unlock learning achievements</li>
                            <li>• Maintain your login streak for bonus rewards</li>
                            <li>• Refer friends to unlock social achievements</li>
                            <li>• Watch ads regularly to complete engagement achievements</li>
                            <li>• Check back often as new achievements are added regularly</li>
                        </ul>
                    </div>
                </div>
            `;
        }

        // =====================================================
        // EVENT LISTENERS SETUP
        // =====================================================

        function setupEventListeners() {
            // Withdrawal form submission
            const withdrawalForm = document.getElementById('withdrawal-form');
            if (withdrawalForm) {
                withdrawalForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    submitWithdrawal();
                });
            }

            // Course category filters
            const categoryButtons = document.querySelectorAll('[data-category]');
            categoryButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const category = this.getAttribute('data-category');
                    filterCourses(category);
                    
                    // Update active state
                    categoryButtons.forEach(btn => {
                        btn.classList.remove('bg-blue-500', 'text-white');
                        btn.classList.add('bg-gray-200', 'text-gray-700');
                    });
                    this.classList.remove('bg-gray-200', 'text-gray-700');
                    this.classList.add('bg-blue-500', 'text-white');
                });
            });

            // Mobile menu toggle
            const mobileMenuButton = document.querySelector('.md\\:hidden');
            if (mobileMenuButton) {
                mobileMenuButton.addEventListener('click', toggleMobileMenu);
            }
        }

        function filterCourses(category) {
            const coursesContainer = document.getElementById('courses-container');
            if (!coursesContainer) return;

            const courseCards = coursesContainer.querySelectorAll('.course-card');
            courseCards.forEach(card => {
                if (category === 'all') {
                    card.style.display = 'block';
                } else {
                    const courseCategory = card.querySelector('p.text-sm')?.textContent?.includes(category);
                    card.style.display = courseCategory ? 'block' : 'none';
                }
            });
        }

        function toggleMobileMenu() {
            const sidebar = document.getElementById('desktop-sidebar');
            sidebar.classList.toggle('hidden');
        }

        // =====================================================
        // CORE FEATURE FUNCTIONS
        // =====================================================

        async function startCourse(courseId) {
            const course = state.lessons.find(l => l.id === courseId);
            if (!course) return;

            showModal(`
                <div class="space-y-4">
                    <h3 class="text-xl font-bold">${course.title}</h3>
                    <div class="course-content">${course.content}</div>
                    <div class="bg-blue-50 p-3 rounded-lg">
                        <p class="text-sm text-blue-700">
                            <i class="fas fa-info-circle mr-1"></i>
                            Complete this course to earn ${formatPoints(course.points)} points
                        </p>
                    </div>
                </div>
            `, async () => {
                // Mark course as completed
                const completedCourses = { ...state.user.completedCourses, [courseId]: true };
                const completedCoursesToday = { ...state.user.completedCoursesToday, [courseId]: true };
                
                await saveUser({ 
                    completedCourses, 
                    completedCoursesToday 
                });
                
                // Add points
                await addPoints(`Complete Course: ${course.title}`, course.points, true);
                
                // Update missions
                await updateMissions('coursesCompleted', 1);
                
                hideModal();
                switchView('learn');
            });
        }

        async function startQuiz(quizId) {
            const quiz = state.quizzes.find(q => q.id === quizId);
            if (!quiz) return;

            state.quizData = {
                currentQuiz: quiz,
                currentQuestion: 0,
                score: 0,
                answers: []
            };

            renderQuizQuestion();
        }

        function renderQuizQuestion() {
            if (!state.quizData) return;

            const quiz = state.quizData.currentQuiz;
            const question = quiz.questions[state.quizData.currentQuestion];
            
            showModal(`
                <div class="space-y-4">
                    <div class="flex justify-between items-center">
                        <h3 class="text-xl font-bold">${quiz.title}</h3>
                        <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded text-sm">
                            Question ${state.quizData.currentQuestion + 1}/${quiz.questions.length}
                        </span>
                    </div>
                    
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <h4 class="font-semibold text-lg mb-3">${question.q}</h4>
                        <div class="space-y-2">
                            ${question.options.map((option, index) => `
                                <button onclick="selectAnswer(${index})" 
                                        class="w-full text-left p-3 border border-gray-300 rounded-lg hover:bg-gray-50 transition quiz-option">
                                    ${option}
                                </button>
                            `).join('')}
                        </div>
                    </div>
                    
                    <div class="bg-yellow-50 p-3 rounded-lg">
                        <p class="text-sm text-yellow-700">
                            <i class="fas fa-lightbulb mr-1"></i>
                            Correct answer earns ${BASE_POINTS_REWARDS.quiz} points
                        </p>
                    </div>
                </div>
            `);
        }

        async function selectAnswer(answerIndex) {
            if (!state.quizData) return;

            const quiz = state.quizData.currentQuiz;
            const question = quiz.questions[state.quizData.currentQuestion];
            const isCorrect = question.options[answerIndex] === question.answer;
            
            // Update score
            if (isCorrect) {
                state.quizData.score++;
            }
            
            state.quizData.answers.push({
                question: question.q,
                selected: question.options[answerIndex],
                correct: question.answer,
                isCorrect: isCorrect
            });

            // Move to next question or finish quiz
            state.quizData.currentQuestion++;
            
            if (state.quizData.currentQuestion < quiz.questions.length) {
                renderQuizQuestion();
            } else {
                await finishQuiz();
            }
        }

        async function finishQuiz() {
            if (!state.quizData) return;

            const quiz = state.quizData.currentQuiz;
            const score = state.quizData.score;
            const totalQuestions = quiz.questions.length;
            const pointsEarned = score * BASE_POINTS_REWARDS.quiz;
            
            // Mark quiz as completed
            const completedQuizzes = { ...state.user.completedQuizzes, [quiz.id]: true };
            await saveUser({ completedQuizzes });
            
            // Add points
            await addPoints(`Complete Quiz: ${quiz.title}`, pointsEarned, true);
            
            // Show results
            showModal(`
                <div class="text-center space-y-4">
                    <div class="w-20 h-20 mx-auto bg-green-100 rounded-full flex items-center justify-center">
                        <i class="fas fa-trophy text-3xl text-green-500"></i>
                    </div>
                    <h3 class="text-2xl font-bold text-gray-800">Quiz Completed!</h3>
                    <p class="text-lg">You scored ${score}/${totalQuestions}</p>
                    <div class="bg-green-50 p-4 rounded-lg">
                        <p class="text-green-700 font-semibold">
                            <i class="fas fa-coins mr-1"></i>
                            You earned ${formatPoints(pointsEarned)} points!
                        </p>
                    </div>
                    
                    ${score === totalQuestions ? `
                        <div class="bg-yellow-50 p-3 rounded-lg">
                            <p class="text-yellow-700 text-sm">
                                <i class="fas fa-star mr-1"></i>
                                Perfect score! Great job!
                            </p>
                        </div>
                    ` : ''}
                </div>
            `, () => {
                hideModal();
                switchView('quiz');
                state.quizData = null;
            });
        }

        function reviewQuiz(quizId) {
            const quiz = state.quizzes.find(q => q.id === quizId);
            if (!quiz) return;

            showModal(`
                <div class="space-y-4">
                    <h3 class="text-xl font-bold">${quiz.title} - Review</h3>
                    <div class="space-y-4 max-h-96 overflow-y-auto">
                        ${quiz.questions.map((question, index) => `
                            <div class="border border-gray-200 rounded-lg p-4">
                                <h4 class="font-semibold mb-2">${index + 1}. ${question.q}</h4>
                                <p class="text-sm text-green-600 mb-1">
                                    <i class="fas fa-check mr-1"></i>
                                    Correct: ${question.answer}
                                </p>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `);
        }

        function watchVideoAd(type) {
            startAdTimer(45, BASE_POINTS_REWARDS.video);
            
            // Update missions
            updateMissions('videosWatched', 1);
        }

        function spinWheel() {
            const today = new Date().toDateString();
            if (state.lastSpinDate === today) {
                showModal(`
                    <div class="text-center space-y-3">
                        <i class="fas fa-exclamation-triangle text-5xl text-yellow-500"></i>
                        <h3 class="text-xl font-bold text-yellow-600">Already Spun Today</h3>
                        <p class="text-gray-600">You can spin the wheel again tomorrow!</p>
                    </div>
                `);
                return;
            }

            const wheel = document.getElementById('wheel');
            const spinBtn = document.getElementById('spin-btn');
            
            if (!wheel || !spinBtn) return;

            // Disable spin button
            spinBtn.disabled = true;
            spinBtn.classList.add('opacity-50', 'cursor-not-allowed');

            // Calculate random prize
            const prizeIndex = Math.floor(Math.random() * WHEEL_PRIZES.length);
            const prize = WHEEL_PRIZES[prizeIndex];
            
            // Calculate rotation (3 full rotations + prize position)
            const segmentAngle = 360 / WHEEL_PRIZES.length;
            const prizePosition = prizeIndex * segmentAngle;
            const extraRotation = 360 * 3; // 3 full rotations
            const totalRotation = extraRotation + (360 - prizePosition) - (segmentAngle / 2);
            
            // Apply spin animation
            wheel.style.transform = `rotate(${totalRotation}deg)`;
            wheel.classList.add('spinning');

            // Wait for animation to complete
            setTimeout(async () => {
                // Handle prize
                if (prize.type === 'points') {
                    await addPoints(`Spin Wheel: ${prize.label}`, prize.value, false);
                } else if (prize.type === 'ad') {
                    showModal(`
                        <div class="text-center space-y-3">
                            <i class="fas fa-ad text-5xl text-purple-500"></i>
                            <h3 class="text-xl font-bold">Watch Ad to Claim Prize</h3>
                            <p class="text-gray-600">You won: ${prize.label}</p>
                            <button onclick="openMonetagAd(100, 30)" class="w-full btn-primary py-3">
                                Watch Ad to Claim
                            </button>
                        </div>
                    `);
                }

                // Update last spin date
                state.lastSpinDate = today;
                await saveUser({ lastSpinDate: today });

                // Re-enable button for tomorrow
                spinBtn.textContent = 'Already Spun Today';
                
                wheel.classList.remove('spinning');
            }, 4000);
        }

        function copyReferralLink() {
            const referralLink = `${window.location.origin}${window.location.pathname}?ref=${state.user?.referralCode}`;
            navigator.clipboard.writeText(referralLink).then(() => {
                showModal(`
                    <div class="text-center space-y-3">
                        <i class="fas fa-check-circle text-5xl text-green-500"></i>
                        <h3 class="text-xl font-bold text-green-600">Link Copied!</h3>
                        <p class="text-gray-600">Referral link copied to clipboard</p>
                    </div>
                `, () => {
                    setTimeout(hideModal, 2000);
                });
            });
        }

        function shareOnWhatsApp() {
            const referralLink = `${window.location.origin}${window.location.pathname}?ref=${state.user?.referralCode}`;
            const message = `Join me on EduHeTech - Learn valuable skills and earn money! Use my referral link: ${referralLink}`;
            const url = `https://wa.me/?text=${encodeURIComponent(message)}`;
            window.open(url, '_blank');
        }

        function shareOnFacebook() {
            const referralLink = `${window.location.origin}${window.location.pathname}?ref=${state.user?.referralCode}`;
            const url = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(referralLink)}`;
            window.open(url, '_blank');
        }

        function shareOnTwitter() {
            const referralLink = `${window.location.origin}${window.location.pathname}?ref=${state.user?.referralCode}`;
            const message = `Join me on EduHeTech - Learn valuable skills and earn money!`;
            const url = `https://twitter.com/intent/tweet?text=${encodeURIComponent(message)}&url=${encodeURIComponent(referralLink)}`;
            window.open(url, '_blank');
        }

        async function submitWithdrawal() {
            const bankName = document.getElementById('bank-name').value;
            const accountNumber = document.getElementById('account-number').value;
            const accountName = document.getElementById('account-name').value;
            const amount = parseInt(document.getElementById('withdrawal-amount').value);

            if (!bankName || !accountNumber || !accountName || !amount) {
                showModal(`
                    <div class="text-center space-y-3">
                        <i class="fas fa-exclamation-triangle text-5xl text-red-500"></i>
                        <h3 class="text-xl font-bold text-red-600">Missing Information</h3>
                        <p class="text-gray-600">Please fill in all required fields</p>
                    </div>
                `);
                return;
            }

            if (amount < MIN_WITHDRAWAL_POINTS) {
                showModal(`
                    <div class="text-center space-y-3">
                        <i class="fas fa-exclamation-triangle text-5xl text-red-500"></i>
                        <h3 class="text-xl font-bold text-red-600">Invalid Amount</h3>
                        <p class="text-gray-600">Minimum withdrawal amount is ${formatPoints(MIN_WITHDRAWAL_POINTS)} points</p>
                    </div>
                `);
                return;
            }

            if (amount > (state.user?.eduPoints || 0)) {
                showModal(`
                    <div class="text-center space-y-3">
                        <i class="fas fa-exclamation-triangle text-5xl text-red-500"></i>
                        <h3 class="text-xl font-bold text-red-600">Insufficient Points</h3>
                        <p class="text-gray-600">You don't have enough points for this withdrawal</p>
                    </div>
                `);
                return;
            }

            try {
                showLoading(true);

                // Create withdrawal request
                const withdrawalData = {
                    userId: state.user.uid,
                    userName: state.user.name,
                    userEmail: state.user.email,
                    bankName: bankName,
                    accountNumber: accountNumber,
                    accountName: accountName,
                    amount: amount,
                    equivalentAmount: amount / ADMIN_CONFIG.POINTS_TO_CURRENCY_RATE,
                    status: 'pending',
                    timestamp: Date.now(),
                    processedAt: null
                };

                const withdrawalId = await saveToCollection(FIRESTORE_COLLECTIONS.WITHDRAWALS, withdrawalData);
                
                if (withdrawalId) {
                    // Deduct points from user
                    const newPoints = state.user.eduPoints - amount;
                    await saveUser({ eduPoints: newPoints });
                    
                    // Update local state
                    state.user.eduPoints = newPoints;
                    
                    showModal(`
                        <div class="text-center space-y-3">
                            <i class="fas fa-check-circle text-5xl text-green-500"></i>
                            <h3 class="text-xl font-bold text-green-600">Withdrawal Request Submitted!</h3>
                            <p class="text-gray-600">Your request for ${formatPoints(amount)} points (₦${(amount / ADMIN_CONFIG.POINTS_TO_CURRENCY_RATE).toFixed(2)}) has been submitted.</p>
                            <p class="text-sm text-blue-600">
                                Processing time: ${state.isPremium ? 'Instant' : '3-5 business days'}
                            </p>
                        </div>
                    `, () => {
                        hideModal();
                        switchView('rewards');
                    });
                }
            } catch (error) {
                console.error("Withdrawal error:", error);
                showModal(`
                    <div class="text-center space-y-3">
                        <i class="fas fa-exclamation-triangle text-5xl text-red-500"></i>
                        <h3 class="text-xl font-bold text-red-600">Withdrawal Failed</h3>
                        <p class="text-gray-600">There was an error processing your withdrawal. Please try again.</p>
                    </div>
                `);
            } finally {
                showLoading(false);
            }
        }

        function activateBoost(type) {
            showModal(`
                <div class="text-center space-y-3">
                    <i class="fas fa-bolt text-5xl text-yellow-500"></i>
                    <h3 class="text-xl font-bold">Activate ${type} Boost</h3>
                    <p class="text-gray-600">This feature is available for Premium users only</p>
                    <button onclick="switchView('premium')" class="w-full bg-gradient-to-r from-purple-500 to-pink-500 text-white py-3 rounded-lg font-semibold transition">
                        Upgrade to Premium
                    </button>
                </div>
            `);
        }

        function showPremiumModal() {
            showModal(`
                <div class="text-center space-y-4">
                    <i class="fas fa-crown text-5xl text-yellow-500 mb-2"></i>
                    <h3 class="text-2xl font-bold text-gray-800">Go Premium</h3>
                    <p class="text-gray-600">Unlock unlimited earnings and exclusive features</p>
                    
                    <div class="bg-gradient-to-r from-purple-500 to-pink-500 text-white p-6 rounded-lg">
                        <div class="text-3xl font-bold mb-2">₦2,500</div>
                        <div class="text-purple-100">per month</div>
                    </div>
                    
                    <div class="space-y-2 text-left">
                        <div class="flex items-center">
                            <i class="fas fa-check text-green-500 mr-2"></i>
                            <span>Unlimited daily earnings</span>
                        </div>
                        <div class="flex items-center">
                            <i class="fas fa-check text-green-500 mr-2"></i>
                            <span>2x points multiplier</span>
                        </div>
                        <div class="flex items-center">
                            <i class="fas fa-check text-green-500 mr-2"></i>
                            <span>Premium ad rewards</span>
                        </div>
                        <div class="flex items-center">
                            <i class="fas fa-check text-green-500 mr-2"></i>
                            <span>Instant withdrawals</span>
                        </div>
                    </div>
                    
                    <button class="w-full bg-white text-purple-600 font-bold py-4 rounded-lg hover:bg-gray-100 transition">
                        Start 7-Day Free Trial
                    </button>
                    <p class="text-xs text-gray-500">Cancel anytime during trial period</p>
                </div>
            `);
        }

        function setupPushNotifications() {
            // This would integrate with a push notification service
            // For now, we'll just log that notifications are available
            if ('Notification' in window) {
                Notification.requestPermission().then(permission => {
                    if (permission === 'granted') {
                        console.log('Push notifications enabled');
                    }
                });
            }
        }

        // =====================================================
        // INITIALIZATION
        // =====================================================

        // Initialize the app when Firebase is ready
        window.initApp = function() {
            console.log("Firebase is ready, initializing app...");
            initializeApp();
        };

        // Start the app initialization
        if (window.firebaseReady) {
            window.initApp();
        } else {
            // Wait for Firebase to be ready
            document.addEventListener('DOMContentLoaded', function() {
                if (window.firebaseReady) {
                    window.initApp();
                }
            });
        }

        // Make functions globally available
        window.switchView = switchView;
        window.copyReferralLink = copyReferralLink;
        window.shareOnWhatsApp = shareOnWhatsApp;
        window.shareOnFacebook = shareOnFacebook;
        window.shareOnTwitter = shareOnTwitter;
        window.submitWithdrawal = submitWithdrawal;
        window.openMonetagAd = openMonetagAd;
        window.watchQuickAd = watchQuickAd;
        window.watchPremiumAd = watchPremiumAd;
        window.watchVideoAd = watchVideoAd;
        window.spinWheel = spinWheel;
        window.activateBoost = activateBoost;
        window.showPremiumModal = showPremiumModal;
        window.handleFirebaseLogout = handleFirebaseLogout;
        window.hideModal = hideModal;
        window.toggleMobileMenu = toggleMobileMenu;
        window.hideLandingPage = hideLandingPage;
        window.scrollToFeatures = scrollToFeatures;
        window.startCourse = startCourse;
        window.startQuiz = startQuiz;
        window.selectAnswer = selectAnswer;
        window.reviewQuiz = reviewQuiz;
    </script>
</body>
</html>
