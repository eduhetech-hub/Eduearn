<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EduHeTech - Learn & Earn</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <style>
        :root {
            --primary-color: #3b82f6; /* Blue 500 */
            --secondary-color: #1d4ed8; /* Blue 700 */
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6; /* Light gray background */
            min-height: 100vh;
        }
        .scrollable-content {
            max-height: calc(100vh - 80px); /* Adjust based on header height */
            overflow-y: auto;
        }
        .btn-primary {
            background-color: var(--primary-color);
            border-radius: 0.5rem;
            color: white;
            transition: transform 0.1s ease;
        }
        .btn-primary:hover {
            background-color: var(--secondary-color);
            transform: translateY(-1px);
        }
        .card {
            background-color: white;
            border-radius: 1rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.06);
        }
        /* Custom modal overlay styling */
        .modal-overlay {
            background-color: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(3px);
            z-index: 50;
        }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="text-gray-800">

    <!-- Global Loader (Hidden by default) -->
    <div id="global-loader" class="fixed inset-0 bg-gray-100/75 flex items-center justify-center hidden z-50">
        <div class="loader"></div>
    </div>

    <!-- Global Modal (Hidden by default) -->
    <div id="global-modal" class="fixed inset-0 modal-overlay flex items-center justify-center hidden">
        <div class="bg-white rounded-xl shadow-2xl p-6 m-4 max-w-sm w-full z-50">
            <div id="modal-content" class="text-center mb-4">
                <!-- Modal content goes here -->
            </div>
            <div class="flex justify-center space-x-4">
                <button id="modal-cancel" onclick="hideModal()" class="px-4 py-2 text-sm font-semibold rounded-lg text-gray-700 bg-gray-200 hover:bg-gray-300 transition">Close</button>
                <button id="modal-confirm" class="px-4 py-2 text-sm font-semibold rounded-lg btn-primary hidden transition">Confirm</button>
            </div>
        </div>
    </div>

    <!-- Main Application Container -->
    <div id="app" class="h-full">
        <!-- Content will be rendered here by JavaScript -->
    </div>


    <!-- Global State and Data Management Scripts (LocalStorage) -->
    <script>
        // --- Local Storage Keys ---
        const LS_USERS = 'eduhetech_users_v2'; // Storage for all user accounts
        const LS_WITHDRAWALS = 'eduhetech_withdrawals_v2'; // Storage for admin panel requests
        const LS_LESSONS = 'eduhetech_lessons_v2';
        const LS_QUIZZES = 'eduhetech_quizzes_v2';
        const SS_CURRENT_USER_ID = 'eduhetech_current_user_id'; // Session storage for login status

        // --- Constants ---
        const MONETAG_LINKS = [
            'https://otieu.com/4/10070319', 'https://otieu.com/4/10070318', 'https://otieu.com/4/10070317',
            'https://otieu.com/4/10070316', 'https://otieu.com/4/10070315', 'https://otieu.com/4/10070314',
            'https://otieu.com/4/7667810', 'https://otieu.com/4/7667754', 'https://otieu.com/4/7667716',
            'https://otieu.com/4/7667811'
        ];
        const BASE_POINTS_REWARDS = {
            lesson: 10,
            quiz: 50,
            ad: 20,
            dailyLogin: 5,
            referral: 100
        };
        const MIN_WITHDRAWAL_POINTS = 500000; // $5

        // --- Global State Management ---
        window.state = {
            user: null, // Current logged-in user object
            currentView: 'loading',
            isLoading: false,
            quizData: null,
            allUsers: {}, // Map of all users (for leaderboards/referrals)
            withdrawalRequests: [],
            lessons: [],
            quizzes: [],
            // --- NEW: Detailed Course Data Structure ---
            detailedCourses: {
                'health': [
                    {
                        title: 'Alternative / Complementary Medicine: A Holistic Approach',
                        description: 'Explores global healing practices outside conventional medicine, focusing on a holistic view that treats the mind, body, and spirit. We delve into the science and ethical considerations.',
                        modules: [
                            'Traditional Systems: Ayurveda (Doshas: Vata, Pitta, Kapha) and TCM (Qi/Chi, meridians).',
                            'Mind-Body Connection: Practices like meditation, biofeedback, and guided imagery.',
                            'Biologically-Based Therapies: Responsible use of herbal supplements and specialized nutritional diets.',
                            'Manipulative Practices: Understanding the principles of Chiropractic and Massage Therapy.'
                        ],
                        color: 'bg-green-500', icon: 'fas fa-hand-holding-heart'
                    },
                    {
                        title: 'Community Health and Health Promotion',
                        description: 'Master the skills needed to improve health outcomes for specific populations. Learn to design, implement, and evaluate health programs.',
                        modules: [
                            'Epidemiology Fundamentals: Biostatistics, disease surveillance, and public health data.',
                            'Social Determinants of Health (SDH): Analyzing the impact of factors like housing and education.',
                            'Health Behavior Change: Applying models to create effective health campaigns and interventions.'
                        ],
                        color: 'bg-lime-500', icon: 'fas fa-users'
                    },
                    {
                        title: 'Dental Therapy: Preventative and Primary Care',
                        description: 'A practical course focused on providing essential preventative and basic restorative oral healthcare in underserved communities.',
                        modules: [
                            'Oral Anatomy & Pathology: Recognizing common diseases like gingivitis and dental caries.',
                            'Preventative Procedures: Mastering techniques for fluoride application and sealants.',
                            'Patient Education: Effective communication strategies for promoting optimal oral hygiene.'
                        ],
                        color: 'bg-emerald-500', icon: 'fas fa-tooth'
                    },
                    {
                        title: 'Environmental Health: Hazard Control and Sustainability',
                        description: 'Study how the natural and built environment impacts human health. Covers risk assessment, pollution control, and global sustainability efforts.',
                        modules: [
                            'Water and Air Quality: Standards, testing, and management of pollutants.',
                            'Solid and Hazardous Waste Management: Safe disposal and regulatory frameworks.',
                            'Climate Change and Health: Analyzing the direct and indirect health effects of global environmental changes.'
                        ],
                        color: 'bg-teal-500', icon: 'fas fa-leaf'
                    }
                ],
                'tech': [
                    {
                        title: 'Modern Web Development: Full Stack Mastery',
                        description: 'The comprehensive track to build highly responsive, data-driven applications using contemporary tools and workflows.',
                        modules: [
                            'Frontend Development (Advanced): Mastering JavaScript ES6+, asynchronous programming, Flexbox, and Grid.',
                            'Component-Based Architecture: Introduction to a major framework (e.g., React or Vue).',
                            'Backend Integration & APIs: Working with RESTful/GraphQL APIs, and securing communication.',
                            'Version Control: Professional workflow using Git and GitHub.'
                        ],
                        color: 'bg-red-500', icon: 'fas fa-code'
                    }
                ],
                'business': [
                    {
                        title: 'Digital Marketing Principles: Strategy & Analytics',
                        description: 'Learn the essential strategies for promoting businesses online. Focus on data-driven decision-making, audience segmentation, and maximizing ROI.',
                        modules: [
                            'Search Engine Optimization (SEO): Technical SEO, content strategy, and keyword research.',
                            'Paid Advertising (PPC): Campaign creation on Google Ads/social media, budgeting, and A/B testing.',
                            'Content and Social Media Strategy: Developing a cohesive content calendar.',
                            'Web Analytics: Setting up and interpreting data from Google Analytics.'
                        ],
                        color: 'bg-yellow-500', icon: 'fas fa-chart-line'
                    },
                    {
                        title: 'Foundational Business and Entrepreneurial Skills',
                        description: 'Essential knowledge for anyone looking to start a venture or advance in a corporate environment. Covers basic finance, management theory, and ethical leadership.',
                        modules: [
                            'Financial Literacy: Understanding budgeting, profit & loss, and basic investment principles.',
                            'Project Management: Introduction to Agile and Scrum methodologies.',
                            'Communication & Negotiation: Developing strong verbal, written, and cross-cultural communication skills.'
                        ],
                        color: 'bg-orange-500', icon: 'fas fa-briefcase'
                    }
                ]
            }
            // --- END NEW DATA ---
        };

        let userId = sessionStorage.getItem(SS_CURRENT_USER_ID);

        // --- Data Persistence Layer (LocalStorage) ---

        function loadAllUsers() {
            try {
                const usersJson = localStorage.getItem(LS_USERS);
                return usersJson ? JSON.parse(usersJson) : {};
            } catch (e) {
                console.error("Error loading users from LS:", e);
                return {};
            }
        }

        function saveAllUsers(users) {
            try {
                localStorage.setItem(LS_USERS, JSON.stringify(users));
                state.allUsers = users; // Keep state in sync
            } catch (e) {
                console.error("Error saving users to LS:", e);
            }
        }

        function loadCollection(key) {
            try {
                const dataJson = localStorage.getItem(key);
                return dataJson ? JSON.parse(dataJson) : [];
            } catch (e) {
                console.error(`Error loading collection ${key} from LS:`, e);
                return [];
            }
        }

        function saveCollection(key, data) {
            try {
                localStorage.setItem(key, JSON.stringify(data));
            } catch (e) {
                console.error(`Error saving collection ${key} to LS:`, e);
            }
        }

        function initMockData() {
            // Check and initialize Lessons
            if (loadCollection(LS_LESSONS).length === 0) {
                const mockLessons = [
                    { id: 'l1', title: 'Introduction to Web Dev', category: 'Tech & Digital Skills', content: 'Learn the basics of HTML, CSS, and JavaScript.', order: 1 },
                    { id: 'l2', title: 'The Power of Nutrition', category: 'Health & Wellness', content: 'Discover how a balanced diet can boost your energy.', order: 2 },
                    { id: 'l3', title: 'World Geography Facts', category: 'General Knowledge', content: 'Test your knowledge on capital cities and world landmarks.', order: 3 }
                ];
                saveCollection(LS_LESSONS, mockLessons);
            }

            // Check and initialize Quizzes
            if (loadCollection(LS_QUIZZES).length === 0) {
                const mockQuiz = {
                    id: 'q1',
                    title: 'Web Basics Quiz',
                    questions: [
                        { q: 'What does HTML stand for?', options: ['Hyper Text Markup Language', 'High Tech Modern Language', 'Home Tool Management Link'], answer: 'Hyper Text Markup Language' },
                        { q: 'What is the main language for styling a web page?', options: ['JavaScript', 'Python', 'CSS'], answer: 'CSS' },
                        { q: 'Which tag is used to define an image?', options: ['<picture>', '<img>', '<src>'], answer: '<img>' },
                        { q: 'Which year was JavaScript invented?', options: ['2005', '1995', '1989'], answer: '1995' },
                        { q: 'What is the correct way to link an external script file?', options: ['<script url=...>', '<script src=...>', '<link rel=... >'], answer: '<script src=...>' }
                    ]
                };
                saveCollection(LS_QUIZZES, [mockQuiz]);
            }
        }

        // --- Utility Functions ---

        function render() {
            const appContainer = document.getElementById('app');
            if (!appContainer) return;
            appContainer.innerHTML = '';
            showLoading(state.isLoading);

            if (!state.user) {
                appContainer.innerHTML = renderAuthScreen();
                attachAuthListeners();
            } else if (state.currentView === 'loading') {
                appContainer.innerHTML = '<div class="flex flex-col items-center justify-center h-full p-8"><i class="fas fa-spinner fa-spin text-4xl text-blue-500"></i><p class="mt-4 text-gray-500">Loading Dashboard...</p></div>';
            } else {
                appContainer.innerHTML = renderHeader() + renderContent();
                attachNavListeners();
                attachContentListeners();
            }
        }

        function showLoading(show) {
            const loader = document.getElementById('global-loader');
            if (loader) {
                loader.style.display = show ? 'flex' : 'none';
            }
        }

        function showModal(content, onConfirm = null) {
            const modal = document.getElementById('global-modal');
            const modalContent = document.getElementById('modal-content');
            const modalConfirm = document.getElementById('modal-confirm');

            if (!modal || !modalContent) return;

            modalContent.innerHTML = content;
            modal.classList.remove('hidden');

            if (onConfirm) {
                modalConfirm.classList.remove('hidden');
                modalConfirm.onclick = () => {
                    onConfirm();
                    modal.classList.add('hidden');
                    modalConfirm.onclick = null;
                };
            } else {
                modalConfirm.classList.add('hidden');
                modalConfirm.onclick = null;
            }
        }

        function hideModal() {
            document.getElementById('global-modal').classList.add('hidden');
        }

        function formatPoints(points) {
            return points.toLocaleString();
        }

        function generateUniqueId() {
            return 'user-' + Date.now().toString(36) + Math.random().toString(36).substring(2);
        }

        // --- Core Application Logic ---

        function updateLeaderboards() {
            const allUsersArray = Object.values(state.allUsers);

            state.leaderboard = allUsersArray
                .sort((a, b) => b.eduPoints - a.eduPoints)
                .slice(0, 10);

            state.topReferrers = allUsersArray
                .sort((a, b) => b.referralCount - a.referralCount)
                .slice(0, 10);
        }

        function initializeData() {
            initMockData();

            state.allUsers = loadAllUsers();
            state.lessons = loadCollection(LS_LESSONS).sort((a, b) => a.order - b.order);
            state.quizzes = loadCollection(LS_QUIZZES);
            state.withdrawalRequests = loadCollection(LS_WITHDRAWALS);

            userId = sessionStorage.getItem(SS_CURRENT_USER_ID);

            if (!userId || !state.allUsers[userId]) {
                state.user = null;
                state.currentView = 'auth';
                render();
                return;
            }

            state.user = state.allUsers[userId];

            // Check Daily Bonus
            const today = new Date().toDateString();
            const lastLoginDate = new Date(state.user.lastLogin).toDateString();
            if (today !== lastLoginDate) {
                addPoints('Daily Login Bonus', BASE_POINTS_REWARDS.dailyLogin);
                state.user.lastLogin = Date.now();
                saveUser(state.user);
            }

            updateLeaderboards();
            state.currentView = 'dashboard';
            render();
        }

        function saveUser(user) {
            state.allUsers[user.userId] = user;
            saveAllUsers(state.allUsers);
        }

        function addPoints(action, points) {
            if (!state.user) return;
            showLoading(true);

            // Update user data
            state.user.eduPoints += points;
            const historyEntry = { action, points, timestamp: Date.now() };
            if (!state.user.history) state.user.history = [];
            state.user.history.push(historyEntry);

            // Save and re-render
            saveUser(state.user);
            updateLeaderboards();

            render();

            // Simple animation feedback
            document.getElementById('coin-animation').innerHTML = `<p class="text-xl text-green-500 font-bold">+${points} EduPoints!</p>`;
            setTimeout(() => document.getElementById('coin-animation').innerHTML = '', 1500);

            showLoading(false);
        }

        function rewardPoints(targetUserId, points, action) {
            const targetUser = state.allUsers[targetUserId];
            if (!targetUser) return;

            targetUser.eduPoints += points;
            const historyEntry = { action, points, timestamp: Date.now() };
            if (!targetUser.history) targetUser.history = [];
            targetUser.history.push(historyEntry);

            saveUser(targetUser);
            updateLeaderboards();
        }

        function trackReferral(referrerId) {
            const targetUser = state.allUsers[referrerId];
            if (!targetUser) return;

            targetUser.referralCount = (targetUser.referralCount || 0) + 1;
            saveUser(targetUser);
            updateLeaderboards();
        }

        // --- Auth/UI Rendering Functions (Placeholders) ---
        // These need to exist for the app to function but were cut off in the user's snippet.

        function renderAuthScreen() {
            // Placeholder - actual content in user's original snippet
            return `
                <div class="min-h-screen flex items-center justify-center bg-gray-50 p-4">
                    <div class="w-full max-w-md card p-8 space-y-6">
                        <h1 class="text-3xl font-extrabold text-center text-blue-600">EduHeTech</h1>
                        <p class="text-center text-gray-500">Log in or Sign up to continue...</p>
                        <div id="auth-form-container" class="space-y-4">
                            ${renderLoginForm()}
                        </div>
                        <div class="text-center">
                            <button id="toggle-auth" class="text-sm text-blue-500 hover:text-blue-700">Need an account? Sign Up</button>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderLoginForm() {
            return `
                <h2 class="text-2xl font-bold text-center">Log In</h2>
                <input type="email" id="login-email" placeholder="Email" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
                <input type="password" id="login-password" placeholder="Password" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
                <button id="login-btn" class="w-full p-3 btn-primary font-semibold">Log In</button>
                <div id="auth-error-message" class="text-red-500 text-sm text-center"></div>
            `;
        }

        // --- Rendering Functions (New/Updated) ---

        function renderSidebar() {
            const navItems = [
                { id: 'dashboard', icon: 'fas fa-home', label: 'Home' },
                { id: 'learn', icon: 'fas fa-graduation-cap', label: 'Learn' },
                { id: 'catalog', icon: 'fas fa-book-open', label: 'Catalog' }, // NEW
                { id: 'quiz', icon: 'fas fa-question-circle', label: 'Quiz' },
                { id: 'ads', icon: 'fas fa-ad', label: 'Ads' },
                { id: 'referral', icon: 'fas fa-share-alt', label: 'Refer' },
                { id: 'rewards', icon: 'fas fa-coins', label: 'Rewards' },
                { id: 'leaderboard', icon: 'fas fa-trophy', label: 'Board' }
            ];

            // Simplified Admin check for localStorage demo
            if (state.user?.email === 'admin@eduhetech.com') {
                navItems.push({ id: 'admin', icon: 'fas fa-user-shield', label: 'Admin' });
            }

            // Mobile Bottom Navigation Bar (Visible on small screens)
            const mobileNav = `
                <nav class="fixed bottom-0 left-0 right-0 bg-white border-t sm:hidden z-20 shadow-lg">
                    <div class="flex justify-around">
                        ${navItems.map(item => `
                            <button data-view="${item.id}" class="nav-item flex flex-col items-center p-2 text-xs ${state.currentView === item.id ? 'text-blue-600 font-bold' : 'text-gray-500 hover:text-blue-500'}">
                                <i class="${item.icon} text-lg"></i>
                                <span>${item.label}</span>
                            </button>
                        `).join('')}
                    </div>
                </nav>
            `;

            // Desktop Sidebar (Hidden on small screens) - Not used in single mobile-first view, but kept for future expansion
            const desktopSidebar = '';

            // User's code ended here, completing the return statement:
            return mobileNav + desktopSidebar;
        }

        function renderContent() {
            let mainContent = '';
            switch(state.currentView) {
                case 'dashboard':
                    mainContent = renderDashboard();
                    break;
                case 'learn':
                    mainContent = renderLearnSection();
                    break;
                case 'catalog': // NEW VIEW CASE
                    mainContent = renderCatalogSection();
                    break;
                case 'quiz':
                    mainContent = renderQuizSection();
                    break;
                case 'ads':
                    mainContent = renderAdsSection();
                    break;
                case 'referral':
                    mainContent = renderReferralSection();
                    break;
                case 'rewards':
                    mainContent = renderRewardsSection();
                    break;
                case 'leaderboard':
                    mainContent = renderLeaderboard();
                    break;
                case 'admin':
                    mainContent = renderAdminPanel();
                    break;
                default:
                    mainContent = renderDashboard();
            }

            return `
                <div class="flex">
                    <!-- Sidebar/Bottom Nav (Mobile-First) -->
                    ${renderSidebar()}
                    <!-- Main Content Area -->
                    <main class="flex-1 p-4 sm:p-6 pb-20 sm:pb-4 scrollable-content" id="main-content">
                        ${mainContent}
                    </main>
                </div>
            `;
        }

        function renderLearnSection() {
            // A simple Learn section showing the featured lessons and linking to the catalog
            const featuredLessons = state.lessons.slice(0, 3);
            const lessonCards = featuredLessons.map(lesson => `
                <div class="card p-4 hover:shadow-lg transition">
                    <h4 class="text-lg font-semibold text-blue-600 truncate">${lesson.title}</h4>
                    <p class="text-sm text-gray-500 mt-1">${lesson.category}</p>
                    <p class="text-xs mt-2">${lesson.content.substring(0, 70)}...</p>
                    <button class="mt-3 text-xs font-medium text-blue-500 hover:text-blue-700">Start Lesson &rarr;</button>
                </div>
            `).join('');

            return `
                <div class="space-y-6">
                    <h2 class="text-3xl font-extrabold text-gray-800">Your Learning Path</h2>

                    <!-- Link to the Full Catalog -->
                    <button data-view="catalog" class="nav-item w-full p-4 btn-primary font-bold text-lg flex items-center justify-center space-x-3 shadow-xl hover:shadow-2xl">
                        <i class="fas fa-book-open"></i> <span>View Full Detailed Course Catalog</span>
                    </button>

                    <h3 class="text-xl font-bold text-gray-700 border-b pb-2">Featured Lessons</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        ${lessonCards}
                    </div>

                    <h3 class="text-xl font-bold text-gray-700 border-b pb-2">Your Progress</h3>
                    <div class="card p-4">
                        <p class="text-sm text-gray-500">You've completed 0 lessons and 0 quizzes.</p>
                        <div class="w-full bg-gray-200 rounded-full h-2.5 mt-2">
                            <div class="bg-green-600 h-2.5 rounded-full" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
            `;
        }

        // --- NEW FUNCTION: Detailed Course Catalog Section ---
        function renderCatalogSection() {
            const courseData = state.detailedCourses;
            let html = `
                <div class="space-y-8">
                    <h2 class="text-4xl font-extrabold text-blue-600 text-center">Full Course Catalog</h2>
                    <p class="text-center text-lg text-gray-600 max-w-3xl mx-auto">Explore our deep-dive learning paths across Health, Technology, and Business to future-proof your career.</p>
            `;

            // Function to render individual course
            const renderCourseCard = (course) => `
                <div class="card p-6 shadow-lg hover:shadow-xl transition duration-300">
                    <div class="flex items-start space-x-4">
                        <div class="p-3 rounded-full ${course.color} text-white text-xl flex-shrink-0">
                            <i class="${course.icon}"></i>
                        </div>
                        <div>
                            <h3 class="text-2xl font-bold text-gray-800">${course.title}</h3>
                            <p class="text-sm text-gray-500 mt-1">${course.description}</p>
                        </div>
                    </div>
                    
                    <div class="mt-4 border-t pt-4">
                        <h4 class="text-lg font-semibold text-gray-700 mb-2">Key Modules:</h4>
                        <ul class="list-disc list-inside text-sm text-gray-600 space-y-1">
                            ${course.modules.map(mod => `<li class="ml-4">${mod}</li>`).join('')}
                        </ul>
                    </div>

                    <button class="w-full mt-6 py-2 btn-primary font-semibold text-sm">Enroll Now (0 EduPoints)</button>
                </div>
            `;

            // Health & Wellness
            html += `
                <div id="health-courses">
                    <h3 class="text-3xl font-bold text-green-600 mt-8 mb-4 border-b-2 border-green-200 pb-2">
                        <i class="fas fa-heartbeat mr-2"></i> Health & Wellness Sciences
                    </h3>
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        ${courseData.health.map(renderCourseCard).join('')}
                    </div>
                </div>
            `;

            // Technology
            html += `
                <div id="tech-courses">
                    <h3 class="text-3xl font-bold text-red-600 mt-8 mb-4 border-b-2 border-red-200 pb-2">
                        <i class="fas fa-microchip mr-2"></i> In-Demand Technology Skills
                    </h3>
                    <div class="grid grid-cols-1 gap-6">
                        ${courseData.tech.map(renderCourseCard).join('')}
                    </div>
                </div>
            `;

            // Business
            html += `
                <div id="business-courses">
                    <h3 class="text-3xl font-bold text-yellow-600 mt-8 mb-4 border-b-2 border-yellow-200 pb-2">
                        <i class="fas fa-lightbulb mr-2"></i> Business & Professional Skills
                    </h3>
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        ${courseData.business.map(renderCourseCard).join('')}
                    </div>
                </div>
            `;

            html += '</div>'; // close space-y-8
            return html;
        }
        // --- END NEW FUNCTION ---

        // --- Dummy Functions for Missing App Logic ---

        function renderDashboard() {
            return `
                <div class="space-y-6">
                    <h2 class="text-3xl font-extrabold text-gray-800">Welcome Back, ${state.user.name}!</h2>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                        <div class="card p-4 text-center bg-blue-100">
                            <i class="fas fa-coins text-2xl text-blue-600"></i>
                            <p class="text-sm font-semibold mt-1">Points</p>
                            <p class="text-xl font-bold text-blue-800">${formatPoints(state.user.eduPoints)}</p>
                        </div>
                        <div class="card p-4 text-center bg-green-100">
                            <i class="fas fa-graduation-cap text-2xl text-green-600"></i>
                            <p class="text-sm font-semibold mt-1">Lessons</p>
                            <p class="text-xl font-bold text-green-800">0</p>
                        </div>
                        <div class="card p-4 text-center bg-yellow-100">
                            <i class="fas fa-question text-2xl text-yellow-600"></i>
                            <p class="text-sm font-semibold mt-1">Quizzes</p>
                            <p class="text-xl font-bold text-yellow-800">0</p>
                        </div>
                        <div class="card p-4 text-center bg-red-100">
                            <i class="fas fa-users text-2xl text-red-600"></i>
                            <p class="text-sm font-semibold mt-1">Referrals</p>
                            <p class="text-xl font-bold text-red-800">${state.user.referralCount || 0}</p>
                        </div>
                    </div>
                    <button data-view="learn" class="nav-item w-full p-3 btn-primary font-semibold">Start Learning Now &rarr;</button>
                    ${renderLeaderboardSummary()}
                </div>
            `;
        }

        function renderQuizSection() {
            return '<div class="p-4 bg-yellow-100 rounded-lg">Quiz section coming soon! You can still earn points by viewing ads.</div>';
        }

        function renderAdsSection() {
            return '<div class="p-4 bg-red-100 rounded-lg">Ads section coming soon!</div>';
        }

        function renderReferralSection() {
            return '<div class="p-4 bg-purple-100 rounded-lg">Referral section coming soon!</div>';
        }

        function renderRewardsSection() {
            return '<div class="p-4 bg-teal-100 rounded-lg">Rewards/Withdrawal section coming soon!</div>';
        }

        function renderLeaderboard() {
            return '<div class="p-4 bg-gray-100 rounded-lg">Full Leaderboard coming soon!</div>';
        }

        function renderAdminPanel() {
            return '<div class="p-4 bg-red-200 rounded-lg">Admin Panel functionality coming soon!</div>';
        }

        function renderLeaderboardSummary() {
            const summary = state.leaderboard.map((user, index) => `
                <li class="flex justify-between items-center py-2 border-b last:border-b-0">
                    <span class="font-bold w-6">${index + 1}.</span>
                    <span class="flex-1 truncate ${user.userId === state.user.userId ? 'text-blue-600 font-semibold' : ''}">${user.name}</span>
                    <span class="text-sm font-mono text-green-700">${formatPoints(user.eduPoints)} Pts</span>
                </li>
            `).join('');

            return `
                <div class="card p-4">
                    <h3 class="text-xl font-bold text-gray-700 mb-3">Top 10 Learners</h3>
                    <ul class="divide-y divide-gray-100">
                        ${summary}
                    </ul>
                </div>
            `;
        }


        // --- Event Listener Attachment Functions (Placeholders) ---

        function attachAuthListeners() {
            const formContainer = document.getElementById('auth-form-container');
            const toggleBtn = document.getElementById('toggle-auth');
            let isLogin = true;

            const renderForm = () => {
                formContainer.innerHTML = isLogin ? renderLoginForm() : renderSignupForm();
                attachFormSubmitListener();
                toggleBtn.textContent = isLogin ? 'Need an account? Sign Up' : 'Already have an account? Log In';
            };

            const attachFormSubmitListener = () => {
                const submitBtn = document.getElementById(isLogin ? 'login-btn' : 'signup-btn');
                if (submitBtn) {
                    submitBtn.onclick = isLogin ? handleLogin : handleSignup;
                }
            };

            toggleBtn.onclick = () => {
                isLogin = !isLogin;
                renderForm();
            };

            renderForm();
        }

        function handleLogin() {
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            const errorElement = document.getElementById('auth-error-message');
            errorElement.textContent = '';

            const user = Object.values(state.allUsers).find(u => u.email === email && u.password === password);

            if (user) {
                sessionStorage.setItem(SS_CURRENT_USER_ID, user.userId);
                initializeData();
            } else {
                errorElement.textContent = 'Invalid email or password.';
            }
        }

        function handleSignup() {
            const name = document.getElementById('signup-name').value;
            const email = document.getElementById('signup-email').value;
            const password = document.getElementById('signup-password').value;
            const referralCode = document.getElementById('signup-referral').value;
            const errorElement = document.getElementById('auth-error-message');
            errorElement.textContent = '';

            if (name.length < 2 || email.length < 5 || password.length < 6) {
                errorElement.textContent = 'Please fill in all fields (password min 6 chars).';
                return;
            }
            if (Object.values(state.allUsers).some(u => u.email === email)) {
                errorElement.textContent = 'This email is already registered.';
                return;
            }

            const newUser = {
                userId: generateUniqueId(),
                name,
                email,
                password, // In a real app, this must be hashed!
                eduPoints: BASE_POINTS_REWARDS.referral, // Signup bonus
                referralCount: 0,
                lastLogin: Date.now(),
                history: [{ action: 'Signup Bonus', points: BASE_POINTS_REWARDS.referral, timestamp: Date.now() }]
            };

            // Process referral
            if (referralCode) {
                const referrer = Object.values(state.allUsers).find(u => u.userId === referralCode);
                if (referrer) {
                    rewardPoints(referrer.userId, BASE_POINTS_REWARDS.referral, `Referral Reward for ${newUser.name}`);
                    trackReferral(referrer.userId);
                } else {
                    showModal(`Referral code "${referralCode}" not found, but you still got your signup bonus!`);
                }
            }

            state.allUsers[newUser.userId] = newUser;
            saveAllUsers(state.allUsers);
            sessionStorage.setItem(SS_CURRENT_USER_ID, newUser.userId);
            initializeData();
        }

        function attachNavListeners() {
            document.querySelectorAll('.nav-item').forEach(button => {
                button.onclick = (e) => {
                    const view = e.currentTarget.getAttribute('data-view');
                    if (view) {
                        state.currentView = view;
                        render();
                    }
                };
            });

            document.getElementById('logout-btn').onclick = handleLogout;
        }

        function handleLogout() {
            showModal('Are you sure you want to log out?', () => {
                sessionStorage.removeItem(SS_CURRENT_USER_ID);
                state.user = null;
                state.currentView = 'auth';
                render();
            });
        }

        function attachContentListeners() {
            // Future listeners for dynamic content (e.g., "Start Lesson" buttons) will go here.
        }

        // --- Initialization ---
        window.onload = initializeData;
    </script>
</body>
</html>



